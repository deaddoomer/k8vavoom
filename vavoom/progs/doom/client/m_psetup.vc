//**************************************************************************
//**
//**    ##   ##    ##    ##   ##   ####     ####   ###     ###
//**    ##   ##  ##  ##  ##   ##  ##  ##   ##  ##  ####   ####
//**     ## ##  ##    ##  ## ##  ##    ## ##    ## ## ## ## ##
//**     ## ##  ########  ## ##  ##    ## ##    ## ##  ###  ##
//**      ###   ##    ##   ###    ##  ##   ##  ##  ##       ##
//**       #    ##    ##    #      ####     ####   ##       ##
//**
//**    $Id$
//**
//**    Copyright (C) 1999-2002 JÆnis Legzdi·ý
//**
//**    This program is free software; you can redistribute it and/or
//**  modify it under the terms of the GNU General Public License
//**  as published by the Free Software Foundation; either version 2
//**  of the License, or (at your option) any later version.
//**
//**    This program is distributed in the hope that it will be useful,
//**  but WITHOUT ANY WARRANTY; without even the implied warranty of
//**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//**  GNU General Public License for more details.
//**
//**************************************************************************
//**
//**    Player setup
//**
//**************************************************************************

// MACROS ------------------------------------------------------------------

#define NUMSKINS		30

// CONSTANTS ---------------------------------------------------------------

// TYPES -------------------------------------------------------------------

struct psetup_menu_t
{
	menu_t menu;
	menuinputline_t name;
	menuswitch_t color;
	menuswitch_t skin;
	menuspriteanim_t anim;
	menumodel_t mdl;
	menutext_t title;
};

// FUNCTION PROTOTYPES -----------------------------------------------------

// DATA DECLARATIONS -------------------------------------------------------

psetup_menu_t PSetupMenu;

string sw_colors[] =
	{ "green", "gray", "brown", "red", "light red", "blue", "rose",
	"light brown"
};

//  FIXME FIXME FIXME
string sw_skins[] = {
	"black.pcx",
	"blackf.pcx",
	"blue.pcx",
	"bluef.pcx",
	"brown.pcx",
	"brownf.pcx",
	"camo.pcx",
	"camof.pcx",
	"green.pcx",
	"greenf.pcx",
	"indigo.pcx",
	"indigof.pcx",
	"lgtblue.pcx",
	"lgtbluef.pcx",
	"navy.pcx",
	"navyf.pcx",
	"orange.pcx",
	"orangef.pcx",
	"pink.pcx",
	"pinkf.pcx",
	"purple.pcx",
	"purplef.pcx",
	"red.pcx",
	"redf.pcx",
	"violet.pcx",
	"violetf.pcx",
	"white.pcx",
	"whitef.pcx",
	"yellow.pcx",
	"yellowf.pcx"
};
int skinbuf[64 / 4];

// CODE --------------------------------------------------------------------

void SetColor(void)
{
	PSetupMenu.anim.translation = PSetupMenu.color.value;
}

void SetSkin(void)
{
	sprint(ARR2STR(skinbuf), "models/players/%s/%s", GetCvarS("model"),
		sw_skins[PSetupMenu.skin.value]);
}

void psetup_func(menucommon_t * item, int msg)
{
	if (msg != MMSG_ACTIVATE)
	{
		return;
	}

	switch (item->id)
	{
	case 1:
		//FIXME
		SetCvarS("name", ARR2STR(PSetupMenu.name.value));
		break;

	case 2:
		SetCvar("color", PSetupMenu.color.value);
		SetColor();
		break;

	case 3:
		SetCvarS("skin", sw_skins[PSetupMenu.skin.value]);
		SetSkin();
		break;
	}
}

void menu_psetup(void)
{
	int x = 16;
	int y = 40;
	model_t *model;
	int i;
	string curskin;

	InitMenu(&PSetupMenu.menu);

	MenuInputLine_Init(&PSetupMenu.name, x, y, "Name", TEXT_SMALLL, 1);
	PSetupMenu.name.callback = psetup_func;
	PSetupMenu.name.id = 1;
	strcpy(ARR2STR(PSetupMenu.name.value), GetCvarS("name"));
	AddMenuItem(&PSetupMenu.menu, &PSetupMenu.name);
	y += 20;

	MenuSwitch_Init(&PSetupMenu.color, x, y, "Color", TEXT_SMALLL,
		GetCvar("color"), 8, &sw_colors[0]);
	PSetupMenu.color.callback = psetup_func;
	PSetupMenu.color.id = 2;
	AddMenuItem(&PSetupMenu.menu, &PSetupMenu.color);
	y += 10;

	R_InstallSprite("PLAY", 500);

	MenuSpriteAnim_Init(&PSetupMenu.anim, 100, 160, 500, 8, 1);
	SetColor();
	AddMenuItem(&PSetupMenu.menu, &PSetupMenu.anim);

	model = InstallModel("models/players/doomguy/tris.md2");
	if (model)
	{
		SetCvarS("model", "doomguy");

		curskin = GetCvarS("skin");
		for (i = 0; i < NUMSKINS; i++)
		{
			if (!strcmp(curskin, sw_skins[i]))
			{
				break;
			}
		}
		if (i == NUMSKINS)
		{
			i = 0;
			SetCvarS("skin", "green.pcx");
		}

		MenuSwitch_Init(&PSetupMenu.skin, x, y, "Skin", TEXT_SMALLL, i,
			NUMSKINS, &sw_skins[0]);
		PSetupMenu.skin.callback = psetup_func;
		PSetupMenu.skin.id = 3;
		AddMenuItem(&PSetupMenu.menu, &PSetupMenu.skin);

		MenuModel_Init(&PSetupMenu.mdl, vector(-64.0, 32.0, -32.0),
			345.0, model, 0);
		PSetupMenu.mdl.skin = ARR2STR(skinbuf);
		SetSkin();
		AddMenuItem(&PSetupMenu.menu, &PSetupMenu.mdl);
	}

	MenuText_InitTitle(&PSetupMenu.title, 160, 24, "PLAYER SETUP", TEXT_BIGC);
	AddMenuItem(&PSetupMenu.menu, &PSetupMenu.title);

	PushMenu(&PSetupMenu.menu);
}

//**************************************************************************
//
//  $Log$
//  Revision 1.7  2002/01/07 12:21:10  dj_jl
//  Changed copyright year
//
//  Revision 1.6  2001/11/09 14:39:44  dj_jl
//  Beautification
//
//  Revision 1.5  2001/10/18 17:39:33  dj_jl
//  A lots of changes for Alpha 2
//
//  Revision 1.4  2001/09/24 17:24:09  dj_jl
//  Beautification
//
//  Revision 1.3  2001/08/15 17:04:47  dj_jl
//  Model setup
//  
//  Revision 1.2  2001/07/27 14:27:51  dj_jl
//  Update with Id-s and Log-s, some fixes
//
//**************************************************************************
