Actor K8Gore_BloodBase {}
Actor K8Gore_BloodBaseTransient : K8Gore_BloodBase {}
////////////////////////////////////////////////////////////////////////////////
// RED BLOOD
////////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////// //
// this is main blood actor; it is spawned by the engine
// Args[0] is damage (0 means "unknown")
// Tracer is damaged actor (can be empty)
Actor K8Gore_Blood : Blood /*: K8Gore_BloodBase*/ Replaces Blood {
  
  Decal K8GoreBloodSplat
  game Doom
  +FORCEXYBILLBOARD
  +NOGRAVITY
  +THRUACTORS
  +CLIENTSIDEONLY
  -ALLOWPARTICLES
  Scale 0.5
  Speed 0

  var int user_spray;

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAA 0 {
        if (Args[0] > 20) A_SetUserVar("user_spray", 1);
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) {
          A_CustomMissile("K8Gore_FlyingBloodFake", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
        }
      }

      // normal
      TNT1 AAAA 0 {
        if (user_spray || GetCVar("k8GoreOpt_BloodAmount") >= 3) {
          A_CustomMissile("K8Gore_FlyingBloodFake", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
        }
      }

      TNT1 A 0 {
/*
        // normal
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) A_CustomMissile("K8Gore_FlyingBloodLevel3", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(40, 60));
*/
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) A_CustomMissile("K8Gore_FlyingBloodLevel3", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(40, 60));

        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 2) A_CustomMissile("K8Gore_FlyingBlood", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(20, 40));
        // normal
        //!if (user_spray && GetCVar("k8GoreOpt_BloodAmount") >= 1) A_CustomMissile("K8Gore_BloodmistSmall", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(10, 40));
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 0) A_CustomMissile("K8Gore_BloodHit", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
      }
      TNT1 AAAA 0 A_CustomMissile("K8Gore_FlyingBloodTrail", 0, 0, random (0, 360), CMF_AIMDIRECTION, random (0, 180))
      Stop

    Spray:
      TNT1 A 0 A_SetUserVar("user_spray", 1)
      Goto Spawn
  }
}


////////////////////////////////////////////////////////////////////////////////
// fast "in-place" blood hit
Actor K8Gore_BloodHit : K8Gore_BloodBase {
  
  height 8
  radius 4
  +NOBLOCKMAP
  +NOGRAVITY
  +NOCLIP
  +CLIENTSIDEONLY
  +NoInteraction
  Scale 0.7
  Renderstyle Translucent
  Alpha 0.7

  States {
    Spawn:
      BLHT ABCDE 1 A_FadeOut(0.1)
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// flying blood; will spawn blood spots and ceiling blood
Actor K8Gore_FlyingBlood /*: K8Gore_BloodBase*/ {
  
  game Doom
  scale 0.5
  speed 4
  health 1
  radius 8
  height 1
  Gravity 0.4 //0.8
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSuper
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +THRUACTORS
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  -NOGRAVITY
  //+KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      B8OD AB 2
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_Jump(256, "Spawn1", "Spawn2", "Spawn3")

    Spawn1:
      B8OD C 0
      Goto MainWorker
    Spawn2:
      B8OD D 0
      Goto MainWorker
    Spawn3:
      B8OD E 0
      Goto MainWorker

    MainWorker:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
    MainLoop:
      "####" "#" 100
      Loop

    Splash:
      "####" "#" 1 A_FadeOut(0.01)
      Loop

    // hits something
    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      "####" "#" 0 A_JumpIf(waterlevel > 1, "DeathDone")
      TNT1 A 0 A_SpawnItem("K8Gore_BloodSpot", 0, 1)
      //TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodChecker", -15, 0, 90, CMF_AIMDIRECTION, 90)
      TNT1 A 0
        {
          if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
          if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
          A_SpawnItemEx("K8Gore_DetectCeilBloodSimpler",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0);
        }
    DeathDone:
      TNT1 A 1
      Stop
   }
}


Actor K8Gore_FlyingBloodLevel3 : K8Gore_FlyingBlood {
  
  Scale 1.0
  Speed 5 //7
  Mass 1
  //+KillOnUnarchive
}


// blood trails spawned by FlyingBlood
Actor K8Gore_FlyingBloodTrail : K8Gore_BloodBase {
  
  game Doom
  scale 0.70
  mass 1
  gravity 0.4
  //renderstyle Translucent
  //alpha 0.7
  Decal K8GoreBloodSplat
  +NOTELEPORT
  +NOBLOCKMAP
  //+NOCLIP
  +THRUACTORS
  +FORCEXYBILLBOARD
  +CLIENTSIDEONLY
  +DontSplash
  +MISSILE
  -NOGRAVITY
  +KillOnUnarchive
  Speed 2

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      //TNT1 A 0 A_k8ConLog(va("BLOOD TRAIL: %C; gravity=%s", getSelf(), Gravity))
      TNT1 A 0 ThrustThingZ(0, random(4, 8)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      BTRL CCCCCCCCCC 4 A_CheckFloor("Death")
      Stop

    Death:
      TNT1 A 0
      Stop

    /*
    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2")
      Stop
    */
  }
}


Actor K8Gore_FlyingBloodFake : K8Gore_BloodBase {
  
  game Doom
  scale 0.5
  speed 3
  health 1
  radius 8
  height 1
  Gravity 0.4
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSplat
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  +THRUACTORS
  -NOGRAVITY
  +KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      B8OD KKKKKKKKKKKK 1 A_FadeOut(0.05)
      Stop

    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2")
      Stop

    Death:
      TNT1 A 0
      Stop
  }
}


Actor K8Gore_FlyingBloodFakeNoDecal : K8Gore_FlyingBloodFake {
  
  Decal None
}


// ////////////////////////////////////////////////////////////////////////// //
// this is blood "arc"
/*
Actor K8Gore_BloodmistSmall : K8Gore_FlyingBlood {
  
  Decal K8GoreBloodSuper
  +MISSILE
  +NOTELEPORT
  +NOBLOCKMAP
  +NOBLOCKMONST
  +DONTSPLASH
  +CLIENTSIDEONLY
  +THRUACTORS
  +NoInteraction
  -NOGRAVITY
  +KillOnUnarchive
  Scale 0.8
  Radius 2
  Height 2
  Speed 8
  Mass 99999
  Gravity 0.1 //0.4
  Scale 0.45
  RenderStyle Translucent
  Alpha 0.7

  States {
    Spawn:
      MSBL ABCDEFGH 1
      //MSBL HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH 1 A_FadeOut(0.05)
      Stop

    Death:
      TNT1 A 0
      //TNT1 A 0 A_CheckFloor("Disappear")
      //MSBL HHHHHHHH 1 A_FadeOut(0.1)
      Stop

    Vanish:
    Disappear:
      TNT1 A 0
      Stop
  }
}
*/


////////////////////////////////////////////////////////////////////////////////
// this is floor blood spot (it may be spawned in the air, though)
Actor K8Gore_BloodSpot : K8Gore_BloodBase {
  
  game Doom
  radius 2
  height 2
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  -NOGRAVITY
  -NoLiftDrop
  +NOBLOCKMAP
  //+NoInteraction
  //Renderstyle Translucent
  //Alpha 0.9
  Mass 99999
  Scale 0.5
  Decal K8GoreBloodSplat
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      // this has no sense, as blood is not in blockmap
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      //TNT1 A 0 A_SetRollExt(0)
      //TNT1 A 0 A_SetYawExt(Random(0, 360))
      //TNT1 A 0 A_SetPitchExt(0)
      TNT1 A 0 A_SetScaleXExt(Random(3, 9)/10.0)
      TNT1 A 0 A_JumpIf(waterlevel > 1, "SplashWater")

    SpawnNormally:
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DoAfterSpawn:
      "####" "#" 16 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")
    EndlessLoop:
      "####" "#" 800
      // it still may disappear after some time
      "####" "#" 0 A_Jump(16, "NormalFadeOut")
      Loop
    NormalFadeOut:
      "####" "#" random(64, 90)
      "####" "#" 0 A_FadeOut(0.01)
      Loop


    SplashWater:
      TNT1 A 0 A_FadeOut(0.3)
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnlyWater", "SpawnBFrameOnlyWater", "SpawnCFrameOnlyWater", "SpawnDFrameOnlyWater")
    SpawnAFrameOnlyWater:
      BPDL A 0
      Goto WaterFadeMain
    SpawnBFrameOnlyWater:
      BPDL B 0
      Goto WaterFadeMain
    SpawnCFrameOnlyWater:
      BPDL C 0
      Goto WaterFadeMain
    SpawnDFrameOnlyWater:
      BPDL D 0
      Goto WaterFadeMain

    WaterFadeMain:
      "####" "#" 16 A_CheckFloor("ItLandedOnWater")
      Loop
    ItLandedOnWater:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      // stay for some time
      "####" "#" random(50, 100)
      // and fade out
    WaterFadeLoop:
      "####" "#" random(9, 24)
      "####" "#" 0 A_FadeOut(0.05)
      Loop


    Death:
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// ceiling blood mechanics

Actor K8Gore_DetectCeilBloodSimpler : K8Gore_BloodBase {
  
  game Doom
  scale 0.4
  speed 0
  health 1
  radius 1
  height 1
  Gravity 0.0
  damage 0
  Renderstyle None
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +NODAMAGETHRUST
  -DONTSPLASH
  +NOGRAVITY

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB0: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: spawn");
      TNT1 A 0 ThrustThingZ(0, 35*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      TNT1 A 2
      Stop

    Death:
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: death");
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB1: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodChecker", -15, 0, 90, CMF_AIMDIRECTION, 90)
      Stop
  }
}


// checks if there is a ceiling above, and isn't hitting a monster
Actor K8Gore_CeilBloodChecker : K8Gore_FlyingBlood {
  
  +THRUACTORS
  +BLOODLESSIMPACT
  +NOBLOCKMAP
  damagetype Blood
  damage 0
  Radius 0
  Height 0
  Speed 400
  Gravity 0.0
  Decal K8GoreBloodSuper

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 4
      Stop

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 1 A_SpawnItem("K8Gore_CeilBloodSpot",0,0,0,1)
      TNT1 A 5
      Stop

    Xdeath:
      TNT1 A 1
      Stop
  }
}


// ceiling blood spot
Actor K8Gore_CeilBloodSpot : K8Gore_BloodSpot {
  
  Projectile
  +SPAWNCEILING
  +StickToCeiling
  +CEILINGHUGGER
  +MOVEWITHSECTOR
  -DOOMBOUNCE
  +NOGRAVITY
  +DontSplash
  +NOBLOCKMAP
  +NoInteraction

  States {
    Spawn:
      BPDL A 0
      "####" "#" 0 A_JumpIfCVarTrue("r_models", "ModelFriendly")
    DoAfterSpawn:
      "####" "#" 1
      "####" "#" 0 A_SpawnItem("K8Gore_DripingBloodLeavesSmallPool")
      "####" "#" 0 A_SpawnItem("K8Gore_CeilBloodTinyBloodSpawner")
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

    DoFadeOut:
      "####" "#" 0 A_JumpIfCVarFalse("r_models", "DieNow")
      "####" "#" 2 A_FadeOut(0.01)
      Loop

    ModelFriendly:
      "####" "#" 0 A_LayToCeilingWithYaw(Random(0, 360))
      //"####" "#" 0 A_k8MoveBy(0, 0, -18)
      "####" "#" 0 A_SetScaleXExt(Random(5, 8)/10.0)
      "####" "#" 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DieNow:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
Actor K8Gore_TinyBlood : K8Gore_BloodBase {
  
  game Doom
  scale 0.2
  speed 7
  health 1
  radius 8
  height 1
  +DontSplash
  Gravity 0.3 //0.7
  Decal K8GoreBloodSplat
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +FORCEXYBILLBOARD
  -EXPLODEONWATER
  //+DOOMBOUNCE
  //BounceFactor 0.01
  -DOOMBOUNCE

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 500
      Stop

    NoSpawn:
      TNT1 A 0
      Stop

    Splash:
      B8OD A 0
      //TNT1 AAA 0 A_CustomMissile("K8Gore_Underblood1", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(30, 150))
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop3"); }
      XDT1 EFGHIJKL 2
      Stop
  }
}


Actor K8Gore_CeilBloodTinyBloodSpawner : K8Gore_TinyBlood {
  
  +NOGRAVITY
  +THRUACTORS
  +NOCLIP
  +NOBLOCKMAP
  +NoInteraction
  +SpawnCeiling

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAAAAAAAAAAAA 5 A_SpawnItemEx("K8Gore_BloodDripingFromCeiling", random(-5, 5), random(-5, 5))
      TNT1 AAAAAAAAAAAAAA 10 A_SpawnItemEx("K8Gore_BloodDripingFromCeiling", random(-5, 5), random(-5, 5))
      TNT1 AAAAAAAAAAAAAA 16 A_SpawnItemEx("K8Gore_BloodDripingFromCeiling", random(-5, 5), random(-5, 5))
      TNT1 AAAAAAAAAAAAAA 24 A_SpawnItem("K8Gore_BloodDripingFromCeiling")
      Stop
  }
}


// blood drops falling from ceiling (yet they're spawned on a floor, wtf?!)
Actor K8Gore_BloodDripingFromCeiling : K8Gore_TinyBlood {
  
  //+DOOMBOUNCE
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  //BounceFactor 0.1
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_Jump(230, "NoSpawn")
      //TNT1 A 0 A_k8ConLog(va("%C: z=%s; ceilingz=%s; floorz=%s; velz=%s; grav=%s", getSelf(), z, ceilingz, floorz, velz, gravity))
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 500
      Loop
  }
}


Actor K8Gore_DripingBloodLeavesSmallPool : K8Gore_TinyBlood {
  
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  -DONTSPLASH
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive
  scale 0.3

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 4
      Goto Death

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 A_SpawnItem("K8Gore_MinuscleBloodSpot")
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      XDT1 EFGHIJKL 2
      Stop
  }
}


Actor K8Gore_MinuscleBloodSpot : K8Gore_BloodSpot {
  
  game Doom
  radius 2
  height 2
  Mass 99999
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  +NOBLOCKMAP
  //+NoInteraction
  //Alpha 0.9
  Scale 0.25
  Decal K8GoreBloodSplat
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_CheckFloor("SpawnNormally")
      Goto Splash

    SpawnNormally:
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      TNT1 A 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")

    SpawnAFrameOnly:
      BPDL A 0
      Goto DoWaitAndFade
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoWaitAndFade
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoWaitAndFade
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoWaitAndFade

    DoWaitAndFade:
      "####" "#" random(400, 800)
    DoFade:
      "####" "#" 1 A_FadeOut(0.04)
      Loop

    Splash:
      B8OD A 1 A_FadeOut(0.04)
      Loop

    Death:
      TNT1 A 0
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
// this is spawned by EntityEx instakill code
// it is replaced by 3d model, and has no sense if models are turned off
// "BPDL A" and "BPDL B" are used to select 3d model
Actor K8Gore_GrowingBloodPool : K8Gore_BloodSpot {
  
  game Doom
  radius 1
  height 1
  Mass 99999
  Health 600
  //StencilColor "49 00 00"
  //Renderstyle Translucent
  //Alpha 0.8
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +MISSILE
  -DONTSPLASH
  +NOBLOCKMAP
  //+NoInteraction
  Scale 1.0
  Decal K8GoreBloodSplat

  States {
    Spawn:
      BPDL A 0
      BPDL A 0 A_JumpIfCVarFalse("r_models", "Die") // no models -- die immediately
      BPDL A 0 A_Jump(256, "Pool1", "Pool2")

    Pool1:
      BPDL A 0
      Goto MainProcessor

    Pool2:
      BPDL B 0
      Goto MainProcessor

    MainProcessor:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
      "####" "#" 0 A_LayToFloorWithYaw(Random(0, 360))
      //"####" "#" 0 A_SetRollExt(0)
      //"####" "#" 0 A_SetYawExt(Random(0, 360))
      //"####" "#" 0 A_SetPitchExt(0)
      "####" "#" 0 A_SetScaleXExt(Random(6, 12)/10.0)

    WaitFloor:
      "####" "#" 5 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")

    Live:
      "####" "#" random(400, 900)
      "####" "#" 0 A_Jump(16, "ItLandedOnWater") // fadeout
      Loop

    ItLandedOnWater:
      "####" "#" 5 A_FadeOut(0.1)
      Loop

    Splash:
      B8OD A 0
      Stop

    Death:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      Goto WaitFloor

    Die:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
Actor K8Gore_Blood_SplatterReplacer : K8Gore_Blood Replaces BloodSplatter {
  
}



////////////////////////////////////////////////////////////////////////////////
// RED TRANSIENT BLOOD
////////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////// //
// this is main blood actor; it is spawned by the engine
// Args[0] is damage (0 means "unknown")
// Tracer is damaged actor (can be empty)
Actor K8Gore_BloodTransient /*: K8Gore_BloodBaseTransient*/ {
  
  Decal K8GoreBloodSplatTransient
  game Doom
  +FORCEXYBILLBOARD
  +NOGRAVITY
  +THRUACTORS
  +CLIENTSIDEONLY
  -ALLOWPARTICLES
  Scale 0.5
  Speed 0

  var int user_spray;

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAA 0 {
        if (Args[0] > 20) A_SetUserVar("user_spray", 1);
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) {
          A_CustomMissile("K8Gore_FlyingBloodFakeTransient", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
        }
      }


      TNT1 A 0 {
/*
*/
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) A_CustomMissile("K8Gore_FlyingBloodLevel3Transient", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(40, 60));

        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 2) A_CustomMissile("K8Gore_FlyingBloodTransient", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(20, 40));
        // transient
        if (GetCVar("k8GoreOpt_BloodAmount") >= 1) A_CustomMissile("K8Gore_FlyingBloodTransient", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(20, 40));
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 0) A_CustomMissile("K8Gore_BloodHitTransient", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
      }
      TNT1 AAAA 0 A_CustomMissile("K8Gore_FlyingBloodTrailTransient", 0, 0, random (0, 360), CMF_AIMDIRECTION, random (0, 180))
      Stop

    Spray:
      TNT1 A 0 A_SetUserVar("user_spray", 1)
      Goto Spawn
  }
}


////////////////////////////////////////////////////////////////////////////////
// fast "in-place" blood hit
Actor K8Gore_BloodHitTransient : K8Gore_BloodBaseTransient {
  
  height 8
  radius 4
  +NOBLOCKMAP
  +NOGRAVITY
  +NOCLIP
  +CLIENTSIDEONLY
  +NoInteraction
  Scale 0.7
  Renderstyle Translucent
  Alpha 0.7

  States {
    Spawn:
      BLHT ABCDE 1 A_FadeOut(0.1)
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// flying blood; will spawn blood spots and ceiling blood
Actor K8Gore_FlyingBloodTransient /*: K8Gore_BloodBaseTransient*/ {
  
  game Doom
  scale 0.5
  speed 4
  health 1
  radius 8
  height 1
  Gravity 0.4 //0.8
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSuperTransient
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +THRUACTORS
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  -NOGRAVITY
  //+KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      B8OD AB 2
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_Jump(256, "Spawn1", "Spawn2", "Spawn3")

    Spawn1:
      B8OD C 0
      Goto MainWorker
    Spawn2:
      B8OD D 0
      Goto MainWorker
    Spawn3:
      B8OD E 0
      Goto MainWorker

    MainWorker:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
    MainLoop:
      "####" "#" 1 A_FadeOut(0.01)
      Loop

    Splash:
      "####" "#" 1 A_FadeOut(0.01)
      Loop

    // hits something
    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      "####" "#" 0 A_JumpIf(waterlevel > 1, "DeathDone")
      TNT1 A 0 A_SpawnItem("K8Gore_BloodSpotTransient", 0, 1)
      //TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerTransient", -15, 0, 90, CMF_AIMDIRECTION, 90)
      TNT1 A 0
        {
          if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
          if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
          A_SpawnItemEx("K8Gore_DetectCeilBloodSimplerTransient",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0);
        }
    DeathDone:
      TNT1 A 1
      Stop
   }
}


Actor K8Gore_FlyingBloodLevel3Transient : K8Gore_FlyingBloodTransient {
  
  Scale 1.0
  Speed 5 //7
  Mass 1
  //+KillOnUnarchive
}


// blood trails spawned by FlyingBlood
Actor K8Gore_FlyingBloodTrailTransient : K8Gore_BloodBaseTransient {
  
  game Doom
  scale 0.70
  mass 1
  gravity 0.4
  //renderstyle Translucent
  //alpha 0.7
  Decal K8GoreBloodSplatTransient
  +NOTELEPORT
  +NOBLOCKMAP
  //+NOCLIP
  +THRUACTORS
  +FORCEXYBILLBOARD
  +CLIENTSIDEONLY
  +DontSplash
  +MISSILE
  -NOGRAVITY
  +KillOnUnarchive
  Speed 2

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      //TNT1 A 0 A_k8ConLog(va("BLOOD TRAIL: %C; gravity=%s", getSelf(), Gravity))
      TNT1 A 0 ThrustThingZ(0, random(4, 8)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      BTRL CCCCCCCCCC 4 A_CheckFloor("Death")
      Stop

    Death:
      TNT1 A 0
      Stop

    /*
    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Transient")
      Stop
    */
  }
}


Actor K8Gore_FlyingBloodFakeTransient : K8Gore_BloodBaseTransient {
  
  game Doom
  scale 0.5
  speed 3
  health 1
  radius 8
  height 1
  Gravity 0.4
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSplatTransient
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  +THRUACTORS
  -NOGRAVITY
  +KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      B8OD KKKKKKKKKKKK 1 A_FadeOut(0.05)
      Stop

    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Transient")
      Stop

    Death:
      TNT1 A 0
      Stop
  }
}


Actor K8Gore_FlyingBloodFakeNoDecalTransient : K8Gore_FlyingBloodFakeTransient {
  
  Decal None
}


// ////////////////////////////////////////////////////////////////////////// //
// this is blood "arc"
/*
Actor K8Gore_BloodmistSmallTransient : K8Gore_FlyingBloodTransient {
  
  Decal K8GoreBloodSuperTransient
  +MISSILE
  +NOTELEPORT
  +NOBLOCKMAP
  +NOBLOCKMONST
  +DONTSPLASH
  +CLIENTSIDEONLY
  +THRUACTORS
  +NoInteraction
  -NOGRAVITY
  +KillOnUnarchive
  Scale 0.8
  Radius 2
  Height 2
  Speed 8
  Mass 99999
  Gravity 0.1 //0.4
  Scale 0.45
  RenderStyle Translucent
  Alpha 0.7

  States {
    Spawn:
      MSBL ABCDEFGH 1
      //MSBL HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH 1 A_FadeOut(0.05)
      Stop

    Death:
      TNT1 A 0
      //TNT1 A 0 A_CheckFloor("Disappear")
      //MSBL HHHHHHHH 1 A_FadeOut(0.1)
      Stop

    Vanish:
    Disappear:
      TNT1 A 0
      Stop
  }
}
*/


////////////////////////////////////////////////////////////////////////////////
// this is floor blood spot (it may be spawned in the air, though)
Actor K8Gore_BloodSpotTransient : K8Gore_BloodBaseTransient {
  
  game Doom
  radius 2
  height 2
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  -NOGRAVITY
  -NoLiftDrop
  +NOBLOCKMAP
  //+NoInteraction
  //Renderstyle Translucent
  //!Alpha 0.6
  //Alpha 0.7
  Mass 99999
  Scale 0.5
  Decal K8GoreBloodSplatTransient
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      // this has no sense, as blood is not in blockmap
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      //TNT1 A 0 A_SetRollExt(0)
      //TNT1 A 0 A_SetYawExt(Random(0, 360))
      //TNT1 A 0 A_SetPitchExt(0)
      TNT1 A 0 A_SetScaleXExt(Random(3, 9)/10.0)
      TNT1 A 0 A_JumpIf(waterlevel > 1, "SplashWater")

    SpawnNormally:
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DoAfterSpawn:
      "####" "#" 35 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")
      "####" "#" random(100, 450)
    FadeOutLoop:
      "####" "#" random(64, 90)
      "####" "#" 0 A_FadeOut(0.01)
      Loop


    SplashWater:
      TNT1 A 0 A_FadeOut(0.3)
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnlyWater", "SpawnBFrameOnlyWater", "SpawnCFrameOnlyWater", "SpawnDFrameOnlyWater")
    SpawnAFrameOnlyWater:
      BPDL A 0
      Goto WaterFadeMain
    SpawnBFrameOnlyWater:
      BPDL B 0
      Goto WaterFadeMain
    SpawnCFrameOnlyWater:
      BPDL C 0
      Goto WaterFadeMain
    SpawnDFrameOnlyWater:
      BPDL D 0
      Goto WaterFadeMain

    WaterFadeMain:
      "####" "#" 16 A_CheckFloor("ItLandedOnWater")
      Loop
    ItLandedOnWater:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      // stay for some time
      "####" "#" random(50, 100)
      // and fade out
    WaterFadeLoop:
      "####" "#" random(9, 24)
      "####" "#" 0 A_FadeOut(0.05)
      Loop


    Death:
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// ceiling blood mechanics

Actor K8Gore_DetectCeilBloodSimplerTransient : K8Gore_BloodBaseTransient {
  
  game Doom
  scale 0.4
  speed 0
  health 1
  radius 1
  height 1
  Gravity 0.0
  damage 0
  Renderstyle None
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +NODAMAGETHRUST
  -DONTSPLASH
  +NOGRAVITY

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB0: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: spawn");
      TNT1 A 0 ThrustThingZ(0, 35*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      TNT1 A 2
      Stop

    Death:
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: death");
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB1: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerTransient", -15, 0, 90, CMF_AIMDIRECTION, 90)
      Stop
  }
}


// checks if there is a ceiling above, and isn't hitting a monster
Actor K8Gore_CeilBloodCheckerTransient : K8Gore_FlyingBloodTransient {
  
  +THRUACTORS
  +BLOODLESSIMPACT
  +NOBLOCKMAP
  damagetype Blood
  damage 0
  Radius 0
  Height 0
  Speed 400
  Gravity 0.0
  Decal K8GoreBloodSuperTransient

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 4
      Stop

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 1 A_SpawnItem("K8Gore_CeilBloodSpotTransient",0,0,0,1)
      TNT1 A 5
      Stop

    Xdeath:
      TNT1 A 1
      Stop
  }
}


// ceiling blood spot
Actor K8Gore_CeilBloodSpotTransient : K8Gore_BloodSpotTransient {
  
  Projectile
  +SPAWNCEILING
  +StickToCeiling
  +CEILINGHUGGER
  +MOVEWITHSECTOR
  -DOOMBOUNCE
  +NOGRAVITY
  +DontSplash
  +NOBLOCKMAP
  +NoInteraction

  States {
    Spawn:
      BPDL A 0
      "####" "#" 0 A_JumpIfCVarTrue("r_models", "ModelFriendly")
    DoAfterSpawn:
      "####" "#" 1
      "####" "#" 0 A_SpawnItem("K8Gore_DripingBloodLeavesSmallPoolTransient")
      "####" "#" 0 A_SpawnItem("K8Gore_CeilBloodTinyBloodSpawnerTransient")
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

    DoFadeOut:
      "####" "#" 0 A_JumpIfCVarFalse("r_models", "DieNow")
      "####" "#" 2 A_FadeOut(0.01)
      Loop

    ModelFriendly:
      "####" "#" 0 A_LayToCeilingWithYaw(Random(0, 360))
      //"####" "#" 0 A_k8MoveBy(0, 0, -18)
      "####" "#" 0 A_SetScaleXExt(Random(5, 8)/10.0)
      "####" "#" 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DieNow:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
Actor K8Gore_TinyBloodTransient : K8Gore_BloodBaseTransient {
  
  game Doom
  scale 0.2
  speed 7
  health 1
  radius 8
  height 1
  +DontSplash
  Gravity 0.3 //0.7
  Decal K8GoreBloodSplatTransient
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +FORCEXYBILLBOARD
  -EXPLODEONWATER
  //+DOOMBOUNCE
  //BounceFactor 0.01
  -DOOMBOUNCE

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
    TinFade:
      BLUX A 2 A_FadeOut(0.01)
      Loop

    NoSpawn:
      TNT1 A 0
      Stop

    Splash:
      B8OD A 0
      //TNT1 AAA 0 A_CustomMissile("K8Gore_Underblood1Transient", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(30, 150))
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop3"); }
      XDT1 EFGHIJKL 2 A_FadeOut(0.1)
      Stop
  }
}


Actor K8Gore_CeilBloodTinyBloodSpawnerTransient : K8Gore_TinyBloodTransient {
  
  +NOGRAVITY
  +THRUACTORS
  +NOCLIP
  +NOBLOCKMAP
  +NoInteraction
  +SpawnCeiling

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAAA 5 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingTransient", random(-5, 5), random(-5, 5))
      TNT1 AAAAA 10 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingTransient", random(-5, 5), random(-5, 5))
      TNT1 AAAAA 16 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingTransient", random(-5, 5), random(-5, 5))
      TNT1 AAAAA 24 A_SpawnItem("K8Gore_BloodDripingFromCeilingTransient")
      Stop
  }
}


// blood drops falling from ceiling (yet they're spawned on a floor, wtf?!)
Actor K8Gore_BloodDripingFromCeilingTransient : K8Gore_TinyBloodTransient {
  
  //+DOOMBOUNCE
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  //BounceFactor 0.1
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_Jump(230, "NoSpawn")
      //TNT1 A 0 A_k8ConLog(va("%C: z=%s; ceilingz=%s; floorz=%s; velz=%s; grav=%s", getSelf(), z, ceilingz, floorz, velz, gravity))
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 100 A_FadeOut(0.1)
      Loop
  }
}


Actor K8Gore_DripingBloodLeavesSmallPoolTransient : K8Gore_TinyBloodTransient {
  
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  -DONTSPLASH
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive
  scale 0.3

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 4
      Goto Death

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 A_SpawnItem("K8Gore_MinuscleBloodSpotTransient")
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      XDT1 EFGHIJKL 2 A_FadeOut(0.1)
      Stop
  }
}


Actor K8Gore_MinuscleBloodSpotTransient : K8Gore_BloodSpotTransient {
  
  game Doom
  radius 2
  height 2
  Mass 99999
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  +NOBLOCKMAP
  //+NoInteraction
  //Alpha 0.9
  Scale 0.25
  Decal K8GoreBloodSplatTransient
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_CheckFloor("SpawnNormally")
      Goto Splash

    SpawnNormally:
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      TNT1 A 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")

    SpawnAFrameOnly:
      BPDL A 0
      Goto DoWaitAndFade
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoWaitAndFade
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoWaitAndFade
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoWaitAndFade

    DoWaitAndFade:
      "####" "#" random(400, 800)
    DoFade:
      "####" "#" 1 A_FadeOut(0.04)
      Loop

    Splash:
      B8OD A 1 A_FadeOut(0.04)
      Loop

    Death:
      TNT1 A 0
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
// this is spawned by EntityEx instakill code
// it is replaced by 3d model, and has no sense if models are turned off
// "BPDL A" and "BPDL B" are used to select 3d model
Actor K8Gore_GrowingBloodPoolTransient : K8Gore_BloodSpotTransient {
  
  game Doom
  radius 1
  height 1
  Mass 99999
  Health 600
  //StencilColor "49 00 00"
  //Renderstyle Translucent
  //Alpha 0.8
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +MISSILE
  -DONTSPLASH
  +NOBLOCKMAP
  //+NoInteraction
  Scale 1.0
  Decal K8GoreBloodSplatTransient

  States {
    Spawn:
      BPDL A 0
      BPDL A 0 A_JumpIfCVarFalse("r_models", "Die") // no models -- die immediately
      BPDL A 0 A_Jump(256, "Pool1", "Pool2")

    Pool1:
      BPDL A 0
      Goto MainProcessor

    Pool2:
      BPDL B 0
      Goto MainProcessor

    MainProcessor:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
      "####" "#" 0 A_LayToFloorWithYaw(Random(0, 360))
      //"####" "#" 0 A_SetRollExt(0)
      //"####" "#" 0 A_SetYawExt(Random(0, 360))
      //"####" "#" 0 A_SetPitchExt(0)
      "####" "#" 0 A_SetScaleXExt(Random(6, 12)/10.0)

    WaitFloor:
      "####" "#" 5 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")

    Live:
      "####" "#" random(400, 900)
      "####" "#" 0 A_Jump(16, "ItLandedOnWater") // fadeout
      Loop

    ItLandedOnWater:
      "####" "#" 5 A_FadeOut(0.1)
      Loop

    Splash:
      B8OD A 0
      Stop

    Death:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      Goto WaitFloor

    Die:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //



////////////////////////////////////////////////////////////////////////////////
// GREEN BLOOD
////////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////// //
// this is main blood actor; it is spawned by the engine
// Args[0] is damage (0 means "unknown")
// Tracer is damaged actor (can be empty)
Actor K8Gore_BloodGreen : BloodGreen /*: K8Gore_BloodBase*/ Replaces BloodGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Decal K8GoreBloodSplatGreen
  game Doom
  +FORCEXYBILLBOARD
  +NOGRAVITY
  +THRUACTORS
  +CLIENTSIDEONLY
  -ALLOWPARTICLES
  Scale 0.5
  Speed 0

  var int user_spray;

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAA 0 {
        if (Args[0] > 20) A_SetUserVar("user_spray", 1);
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) {
          A_CustomMissile("K8Gore_FlyingBloodFakeGreen", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
        }
      }

      // normal
      TNT1 AAAA 0 {
        if (user_spray || GetCVar("k8GoreOpt_BloodAmount") >= 3) {
          A_CustomMissile("K8Gore_FlyingBloodFakeGreen", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
        }
      }

      TNT1 A 0 {
/*
        // normal
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) A_CustomMissile("K8Gore_FlyingBloodLevel3Green", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(40, 60));
*/
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) A_CustomMissile("K8Gore_FlyingBloodLevel3Green", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(40, 60));

        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 2) A_CustomMissile("K8Gore_FlyingBloodGreen", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(20, 40));
        // normal
        //!if (user_spray && GetCVar("k8GoreOpt_BloodAmount") >= 1) A_CustomMissile("K8Gore_BloodmistSmallGreen", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(10, 40));
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 0) A_CustomMissile("K8Gore_BloodHitGreen", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
      }
      TNT1 AAAA 0 A_CustomMissile("K8Gore_FlyingBloodTrailGreen", 0, 0, random (0, 360), CMF_AIMDIRECTION, random (0, 180))
      Stop

    Spray:
      TNT1 A 0 A_SetUserVar("user_spray", 1)
      Goto Spawn
  }
}


////////////////////////////////////////////////////////////////////////////////
// fast "in-place" blood hit
Actor K8Gore_BloodHitGreen : K8Gore_BloodBase {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  height 8
  radius 4
  +NOBLOCKMAP
  +NOGRAVITY
  +NOCLIP
  +CLIENTSIDEONLY
  +NoInteraction
  Scale 0.7
  Renderstyle Translucent
  Alpha 0.7

  States {
    Spawn:
      BLHT ABCDE 1 A_FadeOut(0.1)
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// flying blood; will spawn blood spots and ceiling blood
Actor K8Gore_FlyingBloodGreen /*: K8Gore_BloodBase*/ {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.5
  speed 4
  health 1
  radius 8
  height 1
  Gravity 0.4 //0.8
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSuperGreen
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +THRUACTORS
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  -NOGRAVITY
  //+KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      B8OD AB 2
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_Jump(256, "Spawn1", "Spawn2", "Spawn3")

    Spawn1:
      B8OD C 0
      Goto MainWorker
    Spawn2:
      B8OD D 0
      Goto MainWorker
    Spawn3:
      B8OD E 0
      Goto MainWorker

    MainWorker:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
    MainLoop:
      "####" "#" 100
      Loop

    Splash:
      "####" "#" 1 A_FadeOut(0.01)
      Loop

    // hits something
    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      "####" "#" 0 A_JumpIf(waterlevel > 1, "DeathDone")
      TNT1 A 0 A_SpawnItem("K8Gore_BloodSpotGreen", 0, 1)
      //TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerGreen", -15, 0, 90, CMF_AIMDIRECTION, 90)
      TNT1 A 0
        {
          if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
          if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
          A_SpawnItemEx("K8Gore_DetectCeilBloodSimplerGreen",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0);
        }
    DeathDone:
      TNT1 A 1
      Stop
   }
}


Actor K8Gore_FlyingBloodLevel3Green : K8Gore_FlyingBloodGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Scale 1.0
  Speed 5 //7
  Mass 1
  //+KillOnUnarchive
}


// blood trails spawned by FlyingBlood
Actor K8Gore_FlyingBloodTrailGreen : K8Gore_BloodBase {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.70
  mass 1
  gravity 0.4
  //renderstyle Translucent
  //alpha 0.7
  Decal K8GoreBloodSplatGreen
  +NOTELEPORT
  +NOBLOCKMAP
  //+NOCLIP
  +THRUACTORS
  +FORCEXYBILLBOARD
  +CLIENTSIDEONLY
  +DontSplash
  +MISSILE
  -NOGRAVITY
  +KillOnUnarchive
  Speed 2

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      //TNT1 A 0 A_k8ConLog(va("BLOOD TRAIL: %C; gravity=%s", getSelf(), Gravity))
      TNT1 A 0 ThrustThingZ(0, random(4, 8)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      BTRL CCCCCCCCCC 4 A_CheckFloor("Death")
      Stop

    Death:
      TNT1 A 0
      Stop

    /*
    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Green")
      Stop
    */
  }
}


Actor K8Gore_FlyingBloodFakeGreen : K8Gore_BloodBase {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.5
  speed 3
  health 1
  radius 8
  height 1
  Gravity 0.4
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSplatGreen
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  +THRUACTORS
  -NOGRAVITY
  +KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      B8OD KKKKKKKKKKKK 1 A_FadeOut(0.05)
      Stop

    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Green")
      Stop

    Death:
      TNT1 A 0
      Stop
  }
}


Actor K8Gore_FlyingBloodFakeNoDecalGreen : K8Gore_FlyingBloodFakeGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Decal None
}


// ////////////////////////////////////////////////////////////////////////// //
// this is blood "arc"
/*
Actor K8Gore_BloodmistSmallGreen : K8Gore_FlyingBloodGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Decal K8GoreBloodSuperGreen
  +MISSILE
  +NOTELEPORT
  +NOBLOCKMAP
  +NOBLOCKMONST
  +DONTSPLASH
  +CLIENTSIDEONLY
  +THRUACTORS
  +NoInteraction
  -NOGRAVITY
  +KillOnUnarchive
  Scale 0.8
  Radius 2
  Height 2
  Speed 8
  Mass 99999
  Gravity 0.1 //0.4
  Scale 0.45
  RenderStyle Translucent
  Alpha 0.7

  States {
    Spawn:
      MSBL ABCDEFGH 1
      //MSBL HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH 1 A_FadeOut(0.05)
      Stop

    Death:
      TNT1 A 0
      //TNT1 A 0 A_CheckFloor("Disappear")
      //MSBL HHHHHHHH 1 A_FadeOut(0.1)
      Stop

    Vanish:
    Disappear:
      TNT1 A 0
      Stop
  }
}
*/


////////////////////////////////////////////////////////////////////////////////
// this is floor blood spot (it may be spawned in the air, though)
Actor K8Gore_BloodSpotGreen : K8Gore_BloodBase {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  radius 2
  height 2
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  -NOGRAVITY
  -NoLiftDrop
  +NOBLOCKMAP
  //+NoInteraction
  //Renderstyle Translucent
  //Alpha 0.9
  Mass 99999
  Scale 0.5
  Decal K8GoreBloodSplatGreen
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      // this has no sense, as blood is not in blockmap
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      //TNT1 A 0 A_SetRollExt(0)
      //TNT1 A 0 A_SetYawExt(Random(0, 360))
      //TNT1 A 0 A_SetPitchExt(0)
      TNT1 A 0 A_SetScaleXExt(Random(3, 9)/10.0)
      TNT1 A 0 A_JumpIf(waterlevel > 1, "SplashWater")

    SpawnNormally:
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DoAfterSpawn:
      "####" "#" 16 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")
    EndlessLoop:
      "####" "#" 800
      // it still may disappear after some time
      "####" "#" 0 A_Jump(16, "NormalFadeOut")
      Loop
    NormalFadeOut:
      "####" "#" random(64, 90)
      "####" "#" 0 A_FadeOut(0.01)
      Loop


    SplashWater:
      TNT1 A 0 A_FadeOut(0.3)
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnlyWater", "SpawnBFrameOnlyWater", "SpawnCFrameOnlyWater", "SpawnDFrameOnlyWater")
    SpawnAFrameOnlyWater:
      BPDL A 0
      Goto WaterFadeMain
    SpawnBFrameOnlyWater:
      BPDL B 0
      Goto WaterFadeMain
    SpawnCFrameOnlyWater:
      BPDL C 0
      Goto WaterFadeMain
    SpawnDFrameOnlyWater:
      BPDL D 0
      Goto WaterFadeMain

    WaterFadeMain:
      "####" "#" 16 A_CheckFloor("ItLandedOnWater")
      Loop
    ItLandedOnWater:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      // stay for some time
      "####" "#" random(50, 100)
      // and fade out
    WaterFadeLoop:
      "####" "#" random(9, 24)
      "####" "#" 0 A_FadeOut(0.05)
      Loop


    Death:
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// ceiling blood mechanics

Actor K8Gore_DetectCeilBloodSimplerGreen : K8Gore_BloodBase {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.4
  speed 0
  health 1
  radius 1
  height 1
  Gravity 0.0
  damage 0
  Renderstyle None
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +NODAMAGETHRUST
  -DONTSPLASH
  +NOGRAVITY

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB0: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: spawn");
      TNT1 A 0 ThrustThingZ(0, 35*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      TNT1 A 2
      Stop

    Death:
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: death");
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB1: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerGreen", -15, 0, 90, CMF_AIMDIRECTION, 90)
      Stop
  }
}


// checks if there is a ceiling above, and isn't hitting a monster
Actor K8Gore_CeilBloodCheckerGreen : K8Gore_FlyingBloodGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  +THRUACTORS
  +BLOODLESSIMPACT
  +NOBLOCKMAP
  damagetype Blood
  damage 0
  Radius 0
  Height 0
  Speed 400
  Gravity 0.0
  Decal K8GoreBloodSuperGreen

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 4
      Stop

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 1 A_SpawnItem("K8Gore_CeilBloodSpotGreen",0,0,0,1)
      TNT1 A 5
      Stop

    Xdeath:
      TNT1 A 1
      Stop
  }
}


// ceiling blood spot
Actor K8Gore_CeilBloodSpotGreen : K8Gore_BloodSpotGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Projectile
  +SPAWNCEILING
  +StickToCeiling
  +CEILINGHUGGER
  +MOVEWITHSECTOR
  -DOOMBOUNCE
  +NOGRAVITY
  +DontSplash
  +NOBLOCKMAP
  +NoInteraction

  States {
    Spawn:
      BPDL A 0
      "####" "#" 0 A_JumpIfCVarTrue("r_models", "ModelFriendly")
    DoAfterSpawn:
      "####" "#" 1
      "####" "#" 0 A_SpawnItem("K8Gore_DripingBloodLeavesSmallPoolGreen")
      "####" "#" 0 A_SpawnItem("K8Gore_CeilBloodTinyBloodSpawnerGreen")
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

    DoFadeOut:
      "####" "#" 0 A_JumpIfCVarFalse("r_models", "DieNow")
      "####" "#" 2 A_FadeOut(0.01)
      Loop

    ModelFriendly:
      "####" "#" 0 A_LayToCeilingWithYaw(Random(0, 360))
      //"####" "#" 0 A_k8MoveBy(0, 0, -18)
      "####" "#" 0 A_SetScaleXExt(Random(5, 8)/10.0)
      "####" "#" 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DieNow:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
Actor K8Gore_TinyBloodGreen : K8Gore_BloodBase {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.2
  speed 7
  health 1
  radius 8
  height 1
  +DontSplash
  Gravity 0.3 //0.7
  Decal K8GoreBloodSplatGreen
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +FORCEXYBILLBOARD
  -EXPLODEONWATER
  //+DOOMBOUNCE
  //BounceFactor 0.01
  -DOOMBOUNCE

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 500
      Stop

    NoSpawn:
      TNT1 A 0
      Stop

    Splash:
      B8OD A 0
      //TNT1 AAA 0 A_CustomMissile("K8Gore_Underblood1Green", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(30, 150))
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop3"); }
      XDT1 EFGHIJKL 2
      Stop
  }
}


Actor K8Gore_CeilBloodTinyBloodSpawnerGreen : K8Gore_TinyBloodGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  +NOGRAVITY
  +THRUACTORS
  +NOCLIP
  +NOBLOCKMAP
  +NoInteraction
  +SpawnCeiling

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAAAAAAAAAAAA 5 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingGreen", random(-5, 5), random(-5, 5))
      TNT1 AAAAAAAAAAAAAA 10 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingGreen", random(-5, 5), random(-5, 5))
      TNT1 AAAAAAAAAAAAAA 16 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingGreen", random(-5, 5), random(-5, 5))
      TNT1 AAAAAAAAAAAAAA 24 A_SpawnItem("K8Gore_BloodDripingFromCeilingGreen")
      Stop
  }
}


// blood drops falling from ceiling (yet they're spawned on a floor, wtf?!)
Actor K8Gore_BloodDripingFromCeilingGreen : K8Gore_TinyBloodGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  //+DOOMBOUNCE
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  //BounceFactor 0.1
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_Jump(230, "NoSpawn")
      //TNT1 A 0 A_k8ConLog(va("%C: z=%s; ceilingz=%s; floorz=%s; velz=%s; grav=%s", getSelf(), z, ceilingz, floorz, velz, gravity))
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 500
      Loop
  }
}


Actor K8Gore_DripingBloodLeavesSmallPoolGreen : K8Gore_TinyBloodGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  -DONTSPLASH
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive
  scale 0.3

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 4
      Goto Death

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 A_SpawnItem("K8Gore_MinuscleBloodSpotGreen")
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      XDT1 EFGHIJKL 2
      Stop
  }
}


Actor K8Gore_MinuscleBloodSpotGreen : K8Gore_BloodSpotGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  radius 2
  height 2
  Mass 99999
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  +NOBLOCKMAP
  //+NoInteraction
  //Alpha 0.9
  Scale 0.25
  Decal K8GoreBloodSplatGreen
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_CheckFloor("SpawnNormally")
      Goto Splash

    SpawnNormally:
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      TNT1 A 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")

    SpawnAFrameOnly:
      BPDL A 0
      Goto DoWaitAndFade
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoWaitAndFade
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoWaitAndFade
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoWaitAndFade

    DoWaitAndFade:
      "####" "#" random(400, 800)
    DoFade:
      "####" "#" 1 A_FadeOut(0.04)
      Loop

    Splash:
      B8OD A 1 A_FadeOut(0.04)
      Loop

    Death:
      TNT1 A 0
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
// this is spawned by EntityEx instakill code
// it is replaced by 3d model, and has no sense if models are turned off
// "BPDL A" and "BPDL B" are used to select 3d model
Actor K8Gore_GrowingBloodPoolGreen : K8Gore_BloodSpotGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  radius 1
  height 1
  Mass 99999
  Health 600
  //StencilColor "49 00 00"
  //Renderstyle Translucent
  //Alpha 0.8
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +MISSILE
  -DONTSPLASH
  +NOBLOCKMAP
  //+NoInteraction
  Scale 1.0
  Decal K8GoreBloodSplatGreen

  States {
    Spawn:
      BPDL A 0
      BPDL A 0 A_JumpIfCVarFalse("r_models", "Die") // no models -- die immediately
      BPDL A 0 A_Jump(256, "Pool1", "Pool2")

    Pool1:
      BPDL A 0
      Goto MainProcessor

    Pool2:
      BPDL B 0
      Goto MainProcessor

    MainProcessor:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
      "####" "#" 0 A_LayToFloorWithYaw(Random(0, 360))
      //"####" "#" 0 A_SetRollExt(0)
      //"####" "#" 0 A_SetYawExt(Random(0, 360))
      //"####" "#" 0 A_SetPitchExt(0)
      "####" "#" 0 A_SetScaleXExt(Random(6, 12)/10.0)

    WaitFloor:
      "####" "#" 5 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")

    Live:
      "####" "#" random(400, 900)
      "####" "#" 0 A_Jump(16, "ItLandedOnWater") // fadeout
      Loop

    ItLandedOnWater:
      "####" "#" 5 A_FadeOut(0.1)
      Loop

    Splash:
      B8OD A 0
      Stop

    Death:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      Goto WaitFloor

    Die:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
Actor K8Gore_Blood_SplatterReplacerGreen : K8Gore_Blood Replaces BloodSplatterGreen {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
}



////////////////////////////////////////////////////////////////////////////////
// GREEN TRANSIENT BLOOD
////////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////// //
// this is main blood actor; it is spawned by the engine
// Args[0] is damage (0 means "unknown")
// Tracer is damaged actor (can be empty)
Actor K8Gore_BloodTransient_Green /*: K8Gore_BloodBaseTransient*/ {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Decal K8GoreBloodSplatTransient_Green
  game Doom
  +FORCEXYBILLBOARD
  +NOGRAVITY
  +THRUACTORS
  +CLIENTSIDEONLY
  -ALLOWPARTICLES
  Scale 0.5
  Speed 0

  var int user_spray;

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAA 0 {
        if (Args[0] > 20) A_SetUserVar("user_spray", 1);
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) {
          A_CustomMissile("K8Gore_FlyingBloodFakeTransient_Green", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
        }
      }


      TNT1 A 0 {
/*
*/
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) A_CustomMissile("K8Gore_FlyingBloodLevel3Transient_Green", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(40, 60));

        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 2) A_CustomMissile("K8Gore_FlyingBloodTransient_Green", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(20, 40));
        // transient
        if (GetCVar("k8GoreOpt_BloodAmount") >= 1) A_CustomMissile("K8Gore_FlyingBloodTransient_Green", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(20, 40));
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 0) A_CustomMissile("K8Gore_BloodHitTransient_Green", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
      }
      TNT1 AAAA 0 A_CustomMissile("K8Gore_FlyingBloodTrailTransient_Green", 0, 0, random (0, 360), CMF_AIMDIRECTION, random (0, 180))
      Stop

    Spray:
      TNT1 A 0 A_SetUserVar("user_spray", 1)
      Goto Spawn
  }
}


////////////////////////////////////////////////////////////////////////////////
// fast "in-place" blood hit
Actor K8Gore_BloodHitTransient_Green : K8Gore_BloodBaseTransient {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  height 8
  radius 4
  +NOBLOCKMAP
  +NOGRAVITY
  +NOCLIP
  +CLIENTSIDEONLY
  +NoInteraction
  Scale 0.7
  Renderstyle Translucent
  Alpha 0.7

  States {
    Spawn:
      BLHT ABCDE 1 A_FadeOut(0.1)
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// flying blood; will spawn blood spots and ceiling blood
Actor K8Gore_FlyingBloodTransient_Green /*: K8Gore_BloodBaseTransient*/ {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.5
  speed 4
  health 1
  radius 8
  height 1
  Gravity 0.4 //0.8
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSuperTransient_Green
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +THRUACTORS
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  -NOGRAVITY
  //+KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      B8OD AB 2
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_Jump(256, "Spawn1", "Spawn2", "Spawn3")

    Spawn1:
      B8OD C 0
      Goto MainWorker
    Spawn2:
      B8OD D 0
      Goto MainWorker
    Spawn3:
      B8OD E 0
      Goto MainWorker

    MainWorker:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
    MainLoop:
      "####" "#" 1 A_FadeOut(0.01)
      Loop

    Splash:
      "####" "#" 1 A_FadeOut(0.01)
      Loop

    // hits something
    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      "####" "#" 0 A_JumpIf(waterlevel > 1, "DeathDone")
      TNT1 A 0 A_SpawnItem("K8Gore_BloodSpotTransient_Green", 0, 1)
      //TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerTransient_Green", -15, 0, 90, CMF_AIMDIRECTION, 90)
      TNT1 A 0
        {
          if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
          if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
          A_SpawnItemEx("K8Gore_DetectCeilBloodSimplerTransient_Green",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0);
        }
    DeathDone:
      TNT1 A 1
      Stop
   }
}


Actor K8Gore_FlyingBloodLevel3Transient_Green : K8Gore_FlyingBloodTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Scale 1.0
  Speed 5 //7
  Mass 1
  //+KillOnUnarchive
}


// blood trails spawned by FlyingBlood
Actor K8Gore_FlyingBloodTrailTransient_Green : K8Gore_BloodBaseTransient {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.70
  mass 1
  gravity 0.4
  //renderstyle Translucent
  //alpha 0.7
  Decal K8GoreBloodSplatTransient_Green
  +NOTELEPORT
  +NOBLOCKMAP
  //+NOCLIP
  +THRUACTORS
  +FORCEXYBILLBOARD
  +CLIENTSIDEONLY
  +DontSplash
  +MISSILE
  -NOGRAVITY
  +KillOnUnarchive
  Speed 2

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      //TNT1 A 0 A_k8ConLog(va("BLOOD TRAIL: %C; gravity=%s", getSelf(), Gravity))
      TNT1 A 0 ThrustThingZ(0, random(4, 8)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      BTRL CCCCCCCCCC 4 A_CheckFloor("Death")
      Stop

    Death:
      TNT1 A 0
      Stop

    /*
    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Transient_Green")
      Stop
    */
  }
}


Actor K8Gore_FlyingBloodFakeTransient_Green : K8Gore_BloodBaseTransient {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.5
  speed 3
  health 1
  radius 8
  height 1
  Gravity 0.4
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSplatTransient_Green
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  +THRUACTORS
  -NOGRAVITY
  +KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      B8OD KKKKKKKKKKKK 1 A_FadeOut(0.05)
      Stop

    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Transient_Green")
      Stop

    Death:
      TNT1 A 0
      Stop
  }
}


Actor K8Gore_FlyingBloodFakeNoDecalTransient_Green : K8Gore_FlyingBloodFakeTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Decal None
}


// ////////////////////////////////////////////////////////////////////////// //
// this is blood "arc"
/*
Actor K8Gore_BloodmistSmallTransient_Green : K8Gore_FlyingBloodTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Decal K8GoreBloodSuperTransient_Green
  +MISSILE
  +NOTELEPORT
  +NOBLOCKMAP
  +NOBLOCKMONST
  +DONTSPLASH
  +CLIENTSIDEONLY
  +THRUACTORS
  +NoInteraction
  -NOGRAVITY
  +KillOnUnarchive
  Scale 0.8
  Radius 2
  Height 2
  Speed 8
  Mass 99999
  Gravity 0.1 //0.4
  Scale 0.45
  RenderStyle Translucent
  Alpha 0.7

  States {
    Spawn:
      MSBL ABCDEFGH 1
      //MSBL HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH 1 A_FadeOut(0.05)
      Stop

    Death:
      TNT1 A 0
      //TNT1 A 0 A_CheckFloor("Disappear")
      //MSBL HHHHHHHH 1 A_FadeOut(0.1)
      Stop

    Vanish:
    Disappear:
      TNT1 A 0
      Stop
  }
}
*/


////////////////////////////////////////////////////////////////////////////////
// this is floor blood spot (it may be spawned in the air, though)
Actor K8Gore_BloodSpotTransient_Green : K8Gore_BloodBaseTransient {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  radius 2
  height 2
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  -NOGRAVITY
  -NoLiftDrop
  +NOBLOCKMAP
  //+NoInteraction
  //Renderstyle Translucent
  //!Alpha 0.6
  //Alpha 0.7
  Mass 99999
  Scale 0.5
  Decal K8GoreBloodSplatTransient_Green
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      // this has no sense, as blood is not in blockmap
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      //TNT1 A 0 A_SetRollExt(0)
      //TNT1 A 0 A_SetYawExt(Random(0, 360))
      //TNT1 A 0 A_SetPitchExt(0)
      TNT1 A 0 A_SetScaleXExt(Random(3, 9)/10.0)
      TNT1 A 0 A_JumpIf(waterlevel > 1, "SplashWater")

    SpawnNormally:
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DoAfterSpawn:
      "####" "#" 35 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")
      "####" "#" random(100, 450)
    FadeOutLoop:
      "####" "#" random(64, 90)
      "####" "#" 0 A_FadeOut(0.01)
      Loop


    SplashWater:
      TNT1 A 0 A_FadeOut(0.3)
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnlyWater", "SpawnBFrameOnlyWater", "SpawnCFrameOnlyWater", "SpawnDFrameOnlyWater")
    SpawnAFrameOnlyWater:
      BPDL A 0
      Goto WaterFadeMain
    SpawnBFrameOnlyWater:
      BPDL B 0
      Goto WaterFadeMain
    SpawnCFrameOnlyWater:
      BPDL C 0
      Goto WaterFadeMain
    SpawnDFrameOnlyWater:
      BPDL D 0
      Goto WaterFadeMain

    WaterFadeMain:
      "####" "#" 16 A_CheckFloor("ItLandedOnWater")
      Loop
    ItLandedOnWater:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      // stay for some time
      "####" "#" random(50, 100)
      // and fade out
    WaterFadeLoop:
      "####" "#" random(9, 24)
      "####" "#" 0 A_FadeOut(0.05)
      Loop


    Death:
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// ceiling blood mechanics

Actor K8Gore_DetectCeilBloodSimplerTransient_Green : K8Gore_BloodBaseTransient {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.4
  speed 0
  health 1
  radius 1
  height 1
  Gravity 0.0
  damage 0
  Renderstyle None
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +NODAMAGETHRUST
  -DONTSPLASH
  +NOGRAVITY

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB0: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: spawn");
      TNT1 A 0 ThrustThingZ(0, 35*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      TNT1 A 2
      Stop

    Death:
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: death");
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB1: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerTransient_Green", -15, 0, 90, CMF_AIMDIRECTION, 90)
      Stop
  }
}


// checks if there is a ceiling above, and isn't hitting a monster
Actor K8Gore_CeilBloodCheckerTransient_Green : K8Gore_FlyingBloodTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  +THRUACTORS
  +BLOODLESSIMPACT
  +NOBLOCKMAP
  damagetype Blood
  damage 0
  Radius 0
  Height 0
  Speed 400
  Gravity 0.0
  Decal K8GoreBloodSuperTransient_Green

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 4
      Stop

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 1 A_SpawnItem("K8Gore_CeilBloodSpotTransient_Green",0,0,0,1)
      TNT1 A 5
      Stop

    Xdeath:
      TNT1 A 1
      Stop
  }
}


// ceiling blood spot
Actor K8Gore_CeilBloodSpotTransient_Green : K8Gore_BloodSpotTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  Projectile
  +SPAWNCEILING
  +StickToCeiling
  +CEILINGHUGGER
  +MOVEWITHSECTOR
  -DOOMBOUNCE
  +NOGRAVITY
  +DontSplash
  +NOBLOCKMAP
  +NoInteraction

  States {
    Spawn:
      BPDL A 0
      "####" "#" 0 A_JumpIfCVarTrue("r_models", "ModelFriendly")
    DoAfterSpawn:
      "####" "#" 1
      "####" "#" 0 A_SpawnItem("K8Gore_DripingBloodLeavesSmallPoolTransient_Green")
      "####" "#" 0 A_SpawnItem("K8Gore_CeilBloodTinyBloodSpawnerTransient_Green")
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

    DoFadeOut:
      "####" "#" 0 A_JumpIfCVarFalse("r_models", "DieNow")
      "####" "#" 2 A_FadeOut(0.01)
      Loop

    ModelFriendly:
      "####" "#" 0 A_LayToCeilingWithYaw(Random(0, 360))
      //"####" "#" 0 A_k8MoveBy(0, 0, -18)
      "####" "#" 0 A_SetScaleXExt(Random(5, 8)/10.0)
      "####" "#" 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DieNow:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
Actor K8Gore_TinyBloodTransient_Green : K8Gore_BloodBaseTransient {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  scale 0.2
  speed 7
  health 1
  radius 8
  height 1
  +DontSplash
  Gravity 0.3 //0.7
  Decal K8GoreBloodSplatTransient_Green
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +FORCEXYBILLBOARD
  -EXPLODEONWATER
  //+DOOMBOUNCE
  //BounceFactor 0.01
  -DOOMBOUNCE

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
    TinFade:
      BLUX A 2 A_FadeOut(0.01)
      Loop

    NoSpawn:
      TNT1 A 0
      Stop

    Splash:
      B8OD A 0
      //TNT1 AAA 0 A_CustomMissile("K8Gore_Underblood1Transient_Green", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(30, 150))
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop3"); }
      XDT1 EFGHIJKL 2 A_FadeOut(0.1)
      Stop
  }
}


Actor K8Gore_CeilBloodTinyBloodSpawnerTransient_Green : K8Gore_TinyBloodTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  +NOGRAVITY
  +THRUACTORS
  +NOCLIP
  +NOBLOCKMAP
  +NoInteraction
  +SpawnCeiling

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAAA 5 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingTransient_Green", random(-5, 5), random(-5, 5))
      TNT1 AAAAA 10 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingTransient_Green", random(-5, 5), random(-5, 5))
      TNT1 AAAAA 16 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingTransient_Green", random(-5, 5), random(-5, 5))
      TNT1 AAAAA 24 A_SpawnItem("K8Gore_BloodDripingFromCeilingTransient_Green")
      Stop
  }
}


// blood drops falling from ceiling (yet they're spawned on a floor, wtf?!)
Actor K8Gore_BloodDripingFromCeilingTransient_Green : K8Gore_TinyBloodTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  //+DOOMBOUNCE
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  //BounceFactor 0.1
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_Jump(230, "NoSpawn")
      //TNT1 A 0 A_k8ConLog(va("%C: z=%s; ceilingz=%s; floorz=%s; velz=%s; grav=%s", getSelf(), z, ceilingz, floorz, velz, gravity))
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 100 A_FadeOut(0.1)
      Loop
  }
}


Actor K8Gore_DripingBloodLeavesSmallPoolTransient_Green : K8Gore_TinyBloodTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  -DONTSPLASH
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive
  scale 0.3

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 4
      Goto Death

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 A_SpawnItem("K8Gore_MinuscleBloodSpotTransient_Green")
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      XDT1 EFGHIJKL 2 A_FadeOut(0.1)
      Stop
  }
}


Actor K8Gore_MinuscleBloodSpotTransient_Green : K8Gore_BloodSpotTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  radius 2
  height 2
  Mass 99999
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  +NOBLOCKMAP
  //+NoInteraction
  //Alpha 0.9
  Scale 0.25
  Decal K8GoreBloodSplatTransient_Green
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_CheckFloor("SpawnNormally")
      Goto Splash

    SpawnNormally:
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      TNT1 A 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")

    SpawnAFrameOnly:
      BPDL A 0
      Goto DoWaitAndFade
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoWaitAndFade
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoWaitAndFade
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoWaitAndFade

    DoWaitAndFade:
      "####" "#" random(400, 800)
    DoFade:
      "####" "#" 1 A_FadeOut(0.04)
      Loop

    Splash:
      B8OD A 1 A_FadeOut(0.04)
      Loop

    Death:
      TNT1 A 0
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
// this is spawned by EntityEx instakill code
// it is replaced by 3d model, and has no sense if models are turned off
// "BPDL A" and "BPDL B" are used to select 3d model
Actor K8Gore_GrowingBloodPoolTransient_Green : K8Gore_BloodSpotTransient_Green {
  Translation "16:48=112:127", "64:79=112:127", "164:167=117:127", "168:191=112:127", "232:235=119:127", "236:239=123:127"
  game Doom
  radius 1
  height 1
  Mass 99999
  Health 600
  //StencilColor "49 00 00"
  //Renderstyle Translucent
  //Alpha 0.8
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +MISSILE
  -DONTSPLASH
  +NOBLOCKMAP
  //+NoInteraction
  Scale 1.0
  Decal K8GoreBloodSplatTransient_Green

  States {
    Spawn:
      BPDL A 0
      BPDL A 0 A_JumpIfCVarFalse("r_models", "Die") // no models -- die immediately
      BPDL A 0 A_Jump(256, "Pool1", "Pool2")

    Pool1:
      BPDL A 0
      Goto MainProcessor

    Pool2:
      BPDL B 0
      Goto MainProcessor

    MainProcessor:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
      "####" "#" 0 A_LayToFloorWithYaw(Random(0, 360))
      //"####" "#" 0 A_SetRollExt(0)
      //"####" "#" 0 A_SetYawExt(Random(0, 360))
      //"####" "#" 0 A_SetPitchExt(0)
      "####" "#" 0 A_SetScaleXExt(Random(6, 12)/10.0)

    WaitFloor:
      "####" "#" 5 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")

    Live:
      "####" "#" random(400, 900)
      "####" "#" 0 A_Jump(16, "ItLandedOnWater") // fadeout
      Loop

    ItLandedOnWater:
      "####" "#" 5 A_FadeOut(0.1)
      Loop

    Splash:
      B8OD A 0
      Stop

    Death:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      Goto WaitFloor

    Die:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //



////////////////////////////////////////////////////////////////////////////////
// BLUE BLOOD
////////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////// //
// this is main blood actor; it is spawned by the engine
// Args[0] is damage (0 means "unknown")
// Tracer is damaged actor (can be empty)
Actor K8Gore_BloodBlue : BloodBlue /*: K8Gore_BloodBase*/ Replaces BloodBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Decal K8GoreBloodSplatBlue
  game Doom
  +FORCEXYBILLBOARD
  +NOGRAVITY
  +THRUACTORS
  +CLIENTSIDEONLY
  -ALLOWPARTICLES
  Scale 0.5
  Speed 0

  var int user_spray;

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAA 0 {
        if (Args[0] > 20) A_SetUserVar("user_spray", 1);
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) {
          A_CustomMissile("K8Gore_FlyingBloodFakeBlue", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
        }
      }

      // normal
      TNT1 AAAA 0 {
        if (user_spray || GetCVar("k8GoreOpt_BloodAmount") >= 3) {
          A_CustomMissile("K8Gore_FlyingBloodFakeBlue", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
        }
      }

      TNT1 A 0 {
/*
        // normal
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) A_CustomMissile("K8Gore_FlyingBloodLevel3Blue", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(40, 60));
*/
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) A_CustomMissile("K8Gore_FlyingBloodLevel3Blue", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(40, 60));

        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 2) A_CustomMissile("K8Gore_FlyingBloodBlue", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(20, 40));
        // normal
        //!if (user_spray && GetCVar("k8GoreOpt_BloodAmount") >= 1) A_CustomMissile("K8Gore_BloodmistSmallBlue", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(10, 40));
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 0) A_CustomMissile("K8Gore_BloodHitBlue", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
      }
      TNT1 AAAA 0 A_CustomMissile("K8Gore_FlyingBloodTrailBlue", 0, 0, random (0, 360), CMF_AIMDIRECTION, random (0, 180))
      Stop

    Spray:
      TNT1 A 0 A_SetUserVar("user_spray", 1)
      Goto Spawn
  }
}


////////////////////////////////////////////////////////////////////////////////
// fast "in-place" blood hit
Actor K8Gore_BloodHitBlue : K8Gore_BloodBase {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  height 8
  radius 4
  +NOBLOCKMAP
  +NOGRAVITY
  +NOCLIP
  +CLIENTSIDEONLY
  +NoInteraction
  Scale 0.7
  Renderstyle Translucent
  Alpha 0.7

  States {
    Spawn:
      BLHT ABCDE 1 A_FadeOut(0.1)
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// flying blood; will spawn blood spots and ceiling blood
Actor K8Gore_FlyingBloodBlue /*: K8Gore_BloodBase*/ {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.5
  speed 4
  health 1
  radius 8
  height 1
  Gravity 0.4 //0.8
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSuperBlue
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +THRUACTORS
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  -NOGRAVITY
  //+KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      B8OD AB 2
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_Jump(256, "Spawn1", "Spawn2", "Spawn3")

    Spawn1:
      B8OD C 0
      Goto MainWorker
    Spawn2:
      B8OD D 0
      Goto MainWorker
    Spawn3:
      B8OD E 0
      Goto MainWorker

    MainWorker:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
    MainLoop:
      "####" "#" 100
      Loop

    Splash:
      "####" "#" 1 A_FadeOut(0.01)
      Loop

    // hits something
    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      "####" "#" 0 A_JumpIf(waterlevel > 1, "DeathDone")
      TNT1 A 0 A_SpawnItem("K8Gore_BloodSpotBlue", 0, 1)
      //TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerBlue", -15, 0, 90, CMF_AIMDIRECTION, 90)
      TNT1 A 0
        {
          if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
          if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
          A_SpawnItemEx("K8Gore_DetectCeilBloodSimplerBlue",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0);
        }
    DeathDone:
      TNT1 A 1
      Stop
   }
}


Actor K8Gore_FlyingBloodLevel3Blue : K8Gore_FlyingBloodBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Scale 1.0
  Speed 5 //7
  Mass 1
  //+KillOnUnarchive
}


// blood trails spawned by FlyingBlood
Actor K8Gore_FlyingBloodTrailBlue : K8Gore_BloodBase {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.70
  mass 1
  gravity 0.4
  //renderstyle Translucent
  //alpha 0.7
  Decal K8GoreBloodSplatBlue
  +NOTELEPORT
  +NOBLOCKMAP
  //+NOCLIP
  +THRUACTORS
  +FORCEXYBILLBOARD
  +CLIENTSIDEONLY
  +DontSplash
  +MISSILE
  -NOGRAVITY
  +KillOnUnarchive
  Speed 2

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      //TNT1 A 0 A_k8ConLog(va("BLOOD TRAIL: %C; gravity=%s", getSelf(), Gravity))
      TNT1 A 0 ThrustThingZ(0, random(4, 8)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      BTRL CCCCCCCCCC 4 A_CheckFloor("Death")
      Stop

    Death:
      TNT1 A 0
      Stop

    /*
    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Blue")
      Stop
    */
  }
}


Actor K8Gore_FlyingBloodFakeBlue : K8Gore_BloodBase {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.5
  speed 3
  health 1
  radius 8
  height 1
  Gravity 0.4
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSplatBlue
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  +THRUACTORS
  -NOGRAVITY
  +KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      B8OD KKKKKKKKKKKK 1 A_FadeOut(0.05)
      Stop

    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Blue")
      Stop

    Death:
      TNT1 A 0
      Stop
  }
}


Actor K8Gore_FlyingBloodFakeNoDecalBlue : K8Gore_FlyingBloodFakeBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Decal None
}


// ////////////////////////////////////////////////////////////////////////// //
// this is blood "arc"
/*
Actor K8Gore_BloodmistSmallBlue : K8Gore_FlyingBloodBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Decal K8GoreBloodSuperBlue
  +MISSILE
  +NOTELEPORT
  +NOBLOCKMAP
  +NOBLOCKMONST
  +DONTSPLASH
  +CLIENTSIDEONLY
  +THRUACTORS
  +NoInteraction
  -NOGRAVITY
  +KillOnUnarchive
  Scale 0.8
  Radius 2
  Height 2
  Speed 8
  Mass 99999
  Gravity 0.1 //0.4
  Scale 0.45
  RenderStyle Translucent
  Alpha 0.7

  States {
    Spawn:
      MSBL ABCDEFGH 1
      //MSBL HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH 1 A_FadeOut(0.05)
      Stop

    Death:
      TNT1 A 0
      //TNT1 A 0 A_CheckFloor("Disappear")
      //MSBL HHHHHHHH 1 A_FadeOut(0.1)
      Stop

    Vanish:
    Disappear:
      TNT1 A 0
      Stop
  }
}
*/


////////////////////////////////////////////////////////////////////////////////
// this is floor blood spot (it may be spawned in the air, though)
Actor K8Gore_BloodSpotBlue : K8Gore_BloodBase {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  radius 2
  height 2
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  -NOGRAVITY
  -NoLiftDrop
  +NOBLOCKMAP
  //+NoInteraction
  //Renderstyle Translucent
  //Alpha 0.9
  Mass 99999
  Scale 0.5
  Decal K8GoreBloodSplatBlue
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      // this has no sense, as blood is not in blockmap
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      //TNT1 A 0 A_SetRollExt(0)
      //TNT1 A 0 A_SetYawExt(Random(0, 360))
      //TNT1 A 0 A_SetPitchExt(0)
      TNT1 A 0 A_SetScaleXExt(Random(3, 9)/10.0)
      TNT1 A 0 A_JumpIf(waterlevel > 1, "SplashWater")

    SpawnNormally:
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DoAfterSpawn:
      "####" "#" 16 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")
    EndlessLoop:
      "####" "#" 800
      // it still may disappear after some time
      "####" "#" 0 A_Jump(16, "NormalFadeOut")
      Loop
    NormalFadeOut:
      "####" "#" random(64, 90)
      "####" "#" 0 A_FadeOut(0.01)
      Loop


    SplashWater:
      TNT1 A 0 A_FadeOut(0.3)
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnlyWater", "SpawnBFrameOnlyWater", "SpawnCFrameOnlyWater", "SpawnDFrameOnlyWater")
    SpawnAFrameOnlyWater:
      BPDL A 0
      Goto WaterFadeMain
    SpawnBFrameOnlyWater:
      BPDL B 0
      Goto WaterFadeMain
    SpawnCFrameOnlyWater:
      BPDL C 0
      Goto WaterFadeMain
    SpawnDFrameOnlyWater:
      BPDL D 0
      Goto WaterFadeMain

    WaterFadeMain:
      "####" "#" 16 A_CheckFloor("ItLandedOnWater")
      Loop
    ItLandedOnWater:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      // stay for some time
      "####" "#" random(50, 100)
      // and fade out
    WaterFadeLoop:
      "####" "#" random(9, 24)
      "####" "#" 0 A_FadeOut(0.05)
      Loop


    Death:
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// ceiling blood mechanics

Actor K8Gore_DetectCeilBloodSimplerBlue : K8Gore_BloodBase {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.4
  speed 0
  health 1
  radius 1
  height 1
  Gravity 0.0
  damage 0
  Renderstyle None
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +NODAMAGETHRUST
  -DONTSPLASH
  +NOGRAVITY

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB0: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: spawn");
      TNT1 A 0 ThrustThingZ(0, 35*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      TNT1 A 2
      Stop

    Death:
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: death");
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB1: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerBlue", -15, 0, 90, CMF_AIMDIRECTION, 90)
      Stop
  }
}


// checks if there is a ceiling above, and isn't hitting a monster
Actor K8Gore_CeilBloodCheckerBlue : K8Gore_FlyingBloodBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  +THRUACTORS
  +BLOODLESSIMPACT
  +NOBLOCKMAP
  damagetype Blood
  damage 0
  Radius 0
  Height 0
  Speed 400
  Gravity 0.0
  Decal K8GoreBloodSuperBlue

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 4
      Stop

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 1 A_SpawnItem("K8Gore_CeilBloodSpotBlue",0,0,0,1)
      TNT1 A 5
      Stop

    Xdeath:
      TNT1 A 1
      Stop
  }
}


// ceiling blood spot
Actor K8Gore_CeilBloodSpotBlue : K8Gore_BloodSpotBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Projectile
  +SPAWNCEILING
  +StickToCeiling
  +CEILINGHUGGER
  +MOVEWITHSECTOR
  -DOOMBOUNCE
  +NOGRAVITY
  +DontSplash
  +NOBLOCKMAP
  +NoInteraction

  States {
    Spawn:
      BPDL A 0
      "####" "#" 0 A_JumpIfCVarTrue("r_models", "ModelFriendly")
    DoAfterSpawn:
      "####" "#" 1
      "####" "#" 0 A_SpawnItem("K8Gore_DripingBloodLeavesSmallPoolBlue")
      "####" "#" 0 A_SpawnItem("K8Gore_CeilBloodTinyBloodSpawnerBlue")
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

    DoFadeOut:
      "####" "#" 0 A_JumpIfCVarFalse("r_models", "DieNow")
      "####" "#" 2 A_FadeOut(0.01)
      Loop

    ModelFriendly:
      "####" "#" 0 A_LayToCeilingWithYaw(Random(0, 360))
      //"####" "#" 0 A_k8MoveBy(0, 0, -18)
      "####" "#" 0 A_SetScaleXExt(Random(5, 8)/10.0)
      "####" "#" 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DieNow:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
Actor K8Gore_TinyBloodBlue : K8Gore_BloodBase {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.2
  speed 7
  health 1
  radius 8
  height 1
  +DontSplash
  Gravity 0.3 //0.7
  Decal K8GoreBloodSplatBlue
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +FORCEXYBILLBOARD
  -EXPLODEONWATER
  //+DOOMBOUNCE
  //BounceFactor 0.01
  -DOOMBOUNCE

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 500
      Stop

    NoSpawn:
      TNT1 A 0
      Stop

    Splash:
      B8OD A 0
      //TNT1 AAA 0 A_CustomMissile("K8Gore_Underblood1Blue", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(30, 150))
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop3"); }
      XDT1 EFGHIJKL 2
      Stop
  }
}


Actor K8Gore_CeilBloodTinyBloodSpawnerBlue : K8Gore_TinyBloodBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  +NOGRAVITY
  +THRUACTORS
  +NOCLIP
  +NOBLOCKMAP
  +NoInteraction
  +SpawnCeiling

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAAAAAAAAAAAA 5 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingBlue", random(-5, 5), random(-5, 5))
      TNT1 AAAAAAAAAAAAAA 10 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingBlue", random(-5, 5), random(-5, 5))
      TNT1 AAAAAAAAAAAAAA 16 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingBlue", random(-5, 5), random(-5, 5))
      TNT1 AAAAAAAAAAAAAA 24 A_SpawnItem("K8Gore_BloodDripingFromCeilingBlue")
      Stop
  }
}


// blood drops falling from ceiling (yet they're spawned on a floor, wtf?!)
Actor K8Gore_BloodDripingFromCeilingBlue : K8Gore_TinyBloodBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  //+DOOMBOUNCE
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  //BounceFactor 0.1
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_Jump(230, "NoSpawn")
      //TNT1 A 0 A_k8ConLog(va("%C: z=%s; ceilingz=%s; floorz=%s; velz=%s; grav=%s", getSelf(), z, ceilingz, floorz, velz, gravity))
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 500
      Loop
  }
}


Actor K8Gore_DripingBloodLeavesSmallPoolBlue : K8Gore_TinyBloodBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  -DONTSPLASH
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive
  scale 0.3

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 4
      Goto Death

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 A_SpawnItem("K8Gore_MinuscleBloodSpotBlue")
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      XDT1 EFGHIJKL 2
      Stop
  }
}


Actor K8Gore_MinuscleBloodSpotBlue : K8Gore_BloodSpotBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  radius 2
  height 2
  Mass 99999
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  +NOBLOCKMAP
  //+NoInteraction
  //Alpha 0.9
  Scale 0.25
  Decal K8GoreBloodSplatBlue
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_CheckFloor("SpawnNormally")
      Goto Splash

    SpawnNormally:
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      TNT1 A 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")

    SpawnAFrameOnly:
      BPDL A 0
      Goto DoWaitAndFade
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoWaitAndFade
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoWaitAndFade
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoWaitAndFade

    DoWaitAndFade:
      "####" "#" random(400, 800)
    DoFade:
      "####" "#" 1 A_FadeOut(0.04)
      Loop

    Splash:
      B8OD A 1 A_FadeOut(0.04)
      Loop

    Death:
      TNT1 A 0
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
// this is spawned by EntityEx instakill code
// it is replaced by 3d model, and has no sense if models are turned off
// "BPDL A" and "BPDL B" are used to select 3d model
Actor K8Gore_GrowingBloodPoolBlue : K8Gore_BloodSpotBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  radius 1
  height 1
  Mass 99999
  Health 600
  //StencilColor "49 00 00"
  //Renderstyle Translucent
  //Alpha 0.8
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +MISSILE
  -DONTSPLASH
  +NOBLOCKMAP
  //+NoInteraction
  Scale 1.0
  Decal K8GoreBloodSplatBlue

  States {
    Spawn:
      BPDL A 0
      BPDL A 0 A_JumpIfCVarFalse("r_models", "Die") // no models -- die immediately
      BPDL A 0 A_Jump(256, "Pool1", "Pool2")

    Pool1:
      BPDL A 0
      Goto MainProcessor

    Pool2:
      BPDL B 0
      Goto MainProcessor

    MainProcessor:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
      "####" "#" 0 A_LayToFloorWithYaw(Random(0, 360))
      //"####" "#" 0 A_SetRollExt(0)
      //"####" "#" 0 A_SetYawExt(Random(0, 360))
      //"####" "#" 0 A_SetPitchExt(0)
      "####" "#" 0 A_SetScaleXExt(Random(6, 12)/10.0)

    WaitFloor:
      "####" "#" 5 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")

    Live:
      "####" "#" random(400, 900)
      "####" "#" 0 A_Jump(16, "ItLandedOnWater") // fadeout
      Loop

    ItLandedOnWater:
      "####" "#" 5 A_FadeOut(0.1)
      Loop

    Splash:
      B8OD A 0
      Stop

    Death:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      Goto WaitFloor

    Die:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
Actor K8Gore_Blood_SplatterReplacerBlue : K8Gore_Blood Replaces BloodSplatterBlue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
}



////////////////////////////////////////////////////////////////////////////////
// BLUE TRANSIENT BLOOD
////////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////// //
// this is main blood actor; it is spawned by the engine
// Args[0] is damage (0 means "unknown")
// Tracer is damaged actor (can be empty)
Actor K8Gore_BloodTransient_Blue /*: K8Gore_BloodBaseTransient*/ {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Decal K8GoreBloodSplatTransient_Blue
  game Doom
  +FORCEXYBILLBOARD
  +NOGRAVITY
  +THRUACTORS
  +CLIENTSIDEONLY
  -ALLOWPARTICLES
  Scale 0.5
  Speed 0

  var int user_spray;

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAA 0 {
        if (Args[0] > 20) A_SetUserVar("user_spray", 1);
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) {
          A_CustomMissile("K8Gore_FlyingBloodFakeTransient_Blue", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
        }
      }


      TNT1 A 0 {
/*
*/
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 3) A_CustomMissile("K8Gore_FlyingBloodLevel3Transient_Blue", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(40, 60));

        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 2) A_CustomMissile("K8Gore_FlyingBloodTransient_Blue", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(20, 40));
        // transient
        if (GetCVar("k8GoreOpt_BloodAmount") >= 1) A_CustomMissile("K8Gore_FlyingBloodTransient_Blue", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(20, 40));
        // all
        if (GetCVar("k8GoreOpt_BloodAmount") >= 0) A_CustomMissile("K8Gore_BloodHitTransient_Blue", 0, 0, random(0, 360), CMF_AIMDIRECTION, random(0, 90));
      }
      TNT1 AAAA 0 A_CustomMissile("K8Gore_FlyingBloodTrailTransient_Blue", 0, 0, random (0, 360), CMF_AIMDIRECTION, random (0, 180))
      Stop

    Spray:
      TNT1 A 0 A_SetUserVar("user_spray", 1)
      Goto Spawn
  }
}


////////////////////////////////////////////////////////////////////////////////
// fast "in-place" blood hit
Actor K8Gore_BloodHitTransient_Blue : K8Gore_BloodBaseTransient {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  height 8
  radius 4
  +NOBLOCKMAP
  +NOGRAVITY
  +NOCLIP
  +CLIENTSIDEONLY
  +NoInteraction
  Scale 0.7
  Renderstyle Translucent
  Alpha 0.7

  States {
    Spawn:
      BLHT ABCDE 1 A_FadeOut(0.1)
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// flying blood; will spawn blood spots and ceiling blood
Actor K8Gore_FlyingBloodTransient_Blue /*: K8Gore_BloodBaseTransient*/ {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.5
  speed 4
  health 1
  radius 8
  height 1
  Gravity 0.4 //0.8
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSuperTransient_Blue
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +THRUACTORS
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  -NOGRAVITY
  //+KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      B8OD AB 2
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_Jump(256, "Spawn1", "Spawn2", "Spawn3")

    Spawn1:
      B8OD C 0
      Goto MainWorker
    Spawn2:
      B8OD D 0
      Goto MainWorker
    Spawn3:
      B8OD E 0
      Goto MainWorker

    MainWorker:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
    MainLoop:
      "####" "#" 1 A_FadeOut(0.01)
      Loop

    Splash:
      "####" "#" 1 A_FadeOut(0.01)
      Loop

    // hits something
    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      "####" "#" 0 A_JumpIf(waterlevel > 1, "DeathDone")
      TNT1 A 0 A_SpawnItem("K8Gore_BloodSpotTransient_Blue", 0, 1)
      //TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerTransient_Blue", -15, 0, 90, CMF_AIMDIRECTION, 90)
      TNT1 A 0
        {
          if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
          if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
          A_SpawnItemEx("K8Gore_DetectCeilBloodSimplerTransient_Blue",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0);
        }
    DeathDone:
      TNT1 A 1
      Stop
   }
}


Actor K8Gore_FlyingBloodLevel3Transient_Blue : K8Gore_FlyingBloodTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Scale 1.0
  Speed 5 //7
  Mass 1
  //+KillOnUnarchive
}


// blood trails spawned by FlyingBlood
Actor K8Gore_FlyingBloodTrailTransient_Blue : K8Gore_BloodBaseTransient {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.70
  mass 1
  gravity 0.4
  //renderstyle Translucent
  //alpha 0.7
  Decal K8GoreBloodSplatTransient_Blue
  +NOTELEPORT
  +NOBLOCKMAP
  //+NOCLIP
  +THRUACTORS
  +FORCEXYBILLBOARD
  +CLIENTSIDEONLY
  +DontSplash
  +MISSILE
  -NOGRAVITY
  +KillOnUnarchive
  Speed 2

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      //TNT1 A 0 A_k8ConLog(va("BLOOD TRAIL: %C; gravity=%s", getSelf(), Gravity))
      TNT1 A 0 ThrustThingZ(0, random(4, 8)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      BTRL CCCCCCCCCC 4 A_CheckFloor("Death")
      Stop

    Death:
      TNT1 A 0
      Stop

    /*
    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Transient_Blue")
      Stop
    */
  }
}


Actor K8Gore_FlyingBloodFakeTransient_Blue : K8Gore_BloodBaseTransient {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.5
  speed 3
  health 1
  radius 8
  height 1
  Gravity 0.4
  damage 0
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  Decal K8GoreBloodSplatTransient_Blue
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +BLOODLESSIMPACT
  +FORCEXYBILLBOARD
  +NODAMAGETHRUST
  +MOVEWITHSECTOR
  +CORPSE
  -DONTSPLASH
  +THRUACTORS
  -NOGRAVITY
  +KillOnUnarchive
  Mass 1

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 ThrustThingZ(0, random(2, 4)*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      B8OD KKKKKKKKKKKK 1 A_FadeOut(0.05)
      Stop

    Splash:
      B8OD A 0
      //TNT1 A 0 A_SpawnItem("K8Gore_Underblood2Transient_Blue")
      Stop

    Death:
      TNT1 A 0
      Stop
  }
}


Actor K8Gore_FlyingBloodFakeNoDecalTransient_Blue : K8Gore_FlyingBloodFakeTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Decal None
}


// ////////////////////////////////////////////////////////////////////////// //
// this is blood "arc"
/*
Actor K8Gore_BloodmistSmallTransient_Blue : K8Gore_FlyingBloodTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Decal K8GoreBloodSuperTransient_Blue
  +MISSILE
  +NOTELEPORT
  +NOBLOCKMAP
  +NOBLOCKMONST
  +DONTSPLASH
  +CLIENTSIDEONLY
  +THRUACTORS
  +NoInteraction
  -NOGRAVITY
  +KillOnUnarchive
  Scale 0.8
  Radius 2
  Height 2
  Speed 8
  Mass 99999
  Gravity 0.1 //0.4
  Scale 0.45
  RenderStyle Translucent
  Alpha 0.7

  States {
    Spawn:
      MSBL ABCDEFGH 1
      //MSBL HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH 1 A_FadeOut(0.05)
      Stop

    Death:
      TNT1 A 0
      //TNT1 A 0 A_CheckFloor("Disappear")
      //MSBL HHHHHHHH 1 A_FadeOut(0.1)
      Stop

    Vanish:
    Disappear:
      TNT1 A 0
      Stop
  }
}
*/


////////////////////////////////////////////////////////////////////////////////
// this is floor blood spot (it may be spawned in the air, though)
Actor K8Gore_BloodSpotTransient_Blue : K8Gore_BloodBaseTransient {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  radius 2
  height 2
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  -NOGRAVITY
  -NoLiftDrop
  +NOBLOCKMAP
  //+NoInteraction
  //Renderstyle Translucent
  //!Alpha 0.6
  //Alpha 0.7
  Mass 99999
  Scale 0.5
  Decal K8GoreBloodSplatTransient_Blue
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      // this has no sense, as blood is not in blockmap
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      //TNT1 A 0 A_SetRollExt(0)
      //TNT1 A 0 A_SetYawExt(Random(0, 360))
      //TNT1 A 0 A_SetPitchExt(0)
      TNT1 A 0 A_SetScaleXExt(Random(3, 9)/10.0)
      TNT1 A 0 A_JumpIf(waterlevel > 1, "SplashWater")

    SpawnNormally:
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DoAfterSpawn:
      "####" "#" 35 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")
      "####" "#" random(100, 450)
    FadeOutLoop:
      "####" "#" random(64, 90)
      "####" "#" 0 A_FadeOut(0.01)
      Loop


    SplashWater:
      TNT1 A 0 A_FadeOut(0.3)
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnlyWater", "SpawnBFrameOnlyWater", "SpawnCFrameOnlyWater", "SpawnDFrameOnlyWater")
    SpawnAFrameOnlyWater:
      BPDL A 0
      Goto WaterFadeMain
    SpawnBFrameOnlyWater:
      BPDL B 0
      Goto WaterFadeMain
    SpawnCFrameOnlyWater:
      BPDL C 0
      Goto WaterFadeMain
    SpawnDFrameOnlyWater:
      BPDL D 0
      Goto WaterFadeMain

    WaterFadeMain:
      "####" "#" 16 A_CheckFloor("ItLandedOnWater")
      Loop
    ItLandedOnWater:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      // stay for some time
      "####" "#" random(50, 100)
      // and fade out
    WaterFadeLoop:
      "####" "#" random(9, 24)
      "####" "#" 0 A_FadeOut(0.05)
      Loop


    Death:
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


////////////////////////////////////////////////////////////////////////////////
// ceiling blood mechanics

Actor K8Gore_DetectCeilBloodSimplerTransient_Blue : K8Gore_BloodBaseTransient {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.4
  speed 0
  health 1
  radius 1
  height 1
  Gravity 0.0
  damage 0
  Renderstyle None
  //Renderstyle Translucent
  //Alpha 0.95
  DamageType Blood
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +NODAMAGETHRUST
  -DONTSPLASH
  +NOGRAVITY

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB0: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: spawn");
      TNT1 A 0 ThrustThingZ(0, 35*4, 0, 1)
      //TNT1 A 0 ThrustThing(angle*256.0/360.0, random(0, 2), 1)
      //TNT1 A 0 ThrustThing(random(0, 255), random(0, 2), 1)
      TNT1 A 2
      Stop

    Death:
      //TNT1 A 0 A_k8ConLog("K8Gore_DetectCeilBloodSimpler: death");
      TNT1 A 0
      //TNT1 A 0 A_JumpIfCVarFalse("k8GoreOpt_CeilBlood", "DeathExit");
      TNT1 A 0 {
        if (!GetCVar("k8GoreOpt_CeilBlood")) return state("Null"); // die
        if (GetCVar("k8GoreOpt_BloodAmount") < 2) return state("Null"); // die
        //A_k8ConLog(va("CB1: k8GoreOpt_BloodAmount=%s", GetCVar("k8GoreOpt_BloodAmount")));
      }
      TNT1 A 0 A_CustomMissile("K8Gore_CeilBloodCheckerTransient_Blue", -15, 0, 90, CMF_AIMDIRECTION, 90)
      Stop
  }
}


// checks if there is a ceiling above, and isn't hitting a monster
Actor K8Gore_CeilBloodCheckerTransient_Blue : K8Gore_FlyingBloodTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  +THRUACTORS
  +BLOODLESSIMPACT
  +NOBLOCKMAP
  damagetype Blood
  damage 0
  Radius 0
  Height 0
  Speed 400
  Gravity 0.0
  Decal K8GoreBloodSuperTransient_Blue

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 4
      Stop

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 1 A_SpawnItem("K8Gore_CeilBloodSpotTransient_Blue",0,0,0,1)
      TNT1 A 5
      Stop

    Xdeath:
      TNT1 A 1
      Stop
  }
}


// ceiling blood spot
Actor K8Gore_CeilBloodSpotTransient_Blue : K8Gore_BloodSpotTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  Projectile
  +SPAWNCEILING
  +StickToCeiling
  +CEILINGHUGGER
  +MOVEWITHSECTOR
  -DOOMBOUNCE
  +NOGRAVITY
  +DontSplash
  +NOBLOCKMAP
  +NoInteraction

  States {
    Spawn:
      BPDL A 0
      "####" "#" 0 A_JumpIfCVarTrue("r_models", "ModelFriendly")
    DoAfterSpawn:
      "####" "#" 1
      "####" "#" 0 A_SpawnItem("K8Gore_DripingBloodLeavesSmallPoolTransient_Blue")
      "####" "#" 0 A_SpawnItem("K8Gore_CeilBloodTinyBloodSpawnerTransient_Blue")
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2
      "####" "################################################################################" 2

    DoFadeOut:
      "####" "#" 0 A_JumpIfCVarFalse("r_models", "DieNow")
      "####" "#" 2 A_FadeOut(0.01)
      Loop

    ModelFriendly:
      "####" "#" 0 A_LayToCeilingWithYaw(Random(0, 360))
      //"####" "#" 0 A_k8MoveBy(0, 0, -18)
      "####" "#" 0 A_SetScaleXExt(Random(5, 8)/10.0)
      "####" "#" 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")
    SpawnAFrameOnly:
      BPDL A 0
      Goto DoAfterSpawn
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoAfterSpawn
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoAfterSpawn
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoAfterSpawn

    DieNow:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
Actor K8Gore_TinyBloodTransient_Blue : K8Gore_BloodBaseTransient {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  scale 0.2
  speed 7
  health 1
  radius 8
  height 1
  +DontSplash
  Gravity 0.3 //0.7
  Decal K8GoreBloodSplatTransient_Blue
  +MISSILE
  +CLIENTSIDEONLY
  +NOTELEPORT
  +NOBLOCKMAP
  +FORCEXYBILLBOARD
  -EXPLODEONWATER
  //+DOOMBOUNCE
  //BounceFactor 0.01
  -DOOMBOUNCE

  States {
    Spawn:
      TNT1 A 0
      //TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
    TinFade:
      BLUX A 2 A_FadeOut(0.01)
      Loop

    NoSpawn:
      TNT1 A 0
      Stop

    Splash:
      B8OD A 0
      //TNT1 AAA 0 A_CustomMissile("K8Gore_Underblood1Transient_Blue", 7, 0, random(0, 360), CMF_AIMDIRECTION, random(30, 150))
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop3"); }
      XDT1 EFGHIJKL 2 A_FadeOut(0.1)
      Stop
  }
}


Actor K8Gore_CeilBloodTinyBloodSpawnerTransient_Blue : K8Gore_TinyBloodTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  +NOGRAVITY
  +THRUACTORS
  +NOCLIP
  +NOBLOCKMAP
  +NoInteraction
  +SpawnCeiling

  States {
    Spawn:
      TNT1 A 0
      TNT1 AAAAA 5 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingTransient_Blue", random(-5, 5), random(-5, 5))
      TNT1 AAAAA 10 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingTransient_Blue", random(-5, 5), random(-5, 5))
      TNT1 AAAAA 16 A_SpawnItemEx("K8Gore_BloodDripingFromCeilingTransient_Blue", random(-5, 5), random(-5, 5))
      TNT1 AAAAA 24 A_SpawnItem("K8Gore_BloodDripingFromCeilingTransient_Blue")
      Stop
  }
}


// blood drops falling from ceiling (yet they're spawned on a floor, wtf?!)
Actor K8Gore_BloodDripingFromCeilingTransient_Blue : K8Gore_TinyBloodTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  //+DOOMBOUNCE
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  //BounceFactor 0.1
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_Jump(230, "NoSpawn")
      //TNT1 A 0 A_k8ConLog(va("%C: z=%s; ceilingz=%s; floorz=%s; velz=%s; grav=%s", getSelf(), z, ceilingz, floorz, velz, gravity))
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 100 A_FadeOut(0.1)
      Loop
  }
}


Actor K8Gore_DripingBloodLeavesSmallPoolTransient_Blue : K8Gore_TinyBloodTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  +THRUACTORS
  +CLIENTSIDEONLY
  +SpawnCeiling
  -DONTSPLASH
  -DOOMBOUNCE
  +NOBLOCKMAP
  //+KillOnUnarchive
  scale 0.3

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      BLUX A 4
      Goto Death

    Splash:
      B8OD A 0
      Stop

    Death:
      TNT1 A 0
      TNT1 A 0 A_SpawnItem("K8Gore_MinuscleBloodSpotTransient_Blue")
      TNT1 A 0 { if (GetCVar("k8GoreOpt_BloodDripSound") > 0) A_PlaySound("k8gore/blooddrop2"); }
      XDT1 EFGHIJKL 2 A_FadeOut(0.1)
      Stop
  }
}


Actor K8Gore_MinuscleBloodSpotTransient_Blue : K8Gore_BloodSpotTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  radius 2
  height 2
  Mass 99999
  Health 300
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +NOTARGET
  -SHOOTABLE
  +NOBLOOD
  -DONTSPLASH
  -SOLID
  +THRUACTORS
  +NOBLOCKMAP
  //+NoInteraction
  //Alpha 0.9
  Scale 0.25
  Decal K8GoreBloodSplatTransient_Blue
  DamageFactor "TeleportRemover", 100.0

  States {
    Spawn:
      TNT1 A 0
      TNT1 A 0 A_JumpIfCVarFalse("r_models", "Death") // no models -- die immediately
      TNT1 A 0 A_JumpIf(waterlevel > 1, "Splash")
      TNT1 A 0 A_CheckFloor("SpawnNormally")
      Goto Splash

    SpawnNormally:
      TNT1 A 0 A_LayToFloorWithYaw(Random(0, 360))
      TNT1 A 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      TNT1 A 0 A_Jump(256, "SpawnAFrameOnly", "SpawnBFrameOnly", "SpawnCFrameOnly", "SpawnDFrameOnly")

    SpawnAFrameOnly:
      BPDL A 0
      Goto DoWaitAndFade
    SpawnBFrameOnly:
      BPDL B 0
      Goto DoWaitAndFade
    SpawnCFrameOnly:
      BPDL C 0
      Goto DoWaitAndFade
    SpawnDFrameOnly:
      BPDL D 0
      Goto DoWaitAndFade

    DoWaitAndFade:
      "####" "#" random(400, 800)
    DoFade:
      "####" "#" 1 A_FadeOut(0.04)
      Loop

    Splash:
      B8OD A 1 A_FadeOut(0.04)
      Loop

    Death:
      TNT1 A 0
      TNT1 A 0 A_NoBlocking
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
// this is spawned by EntityEx instakill code
// it is replaced by 3d model, and has no sense if models are turned off
// "BPDL A" and "BPDL B" are used to select 3d model
Actor K8Gore_GrowingBloodPoolTransient_Blue : K8Gore_BloodSpotTransient_Blue {
  Translation "16:48=240:247", "64:79=240:247", "164:167=201:207", "168:191=192:207", "232:235=100:207", "236:239=199:207"
  game Doom
  radius 1
  height 1
  Mass 99999
  Health 600
  //StencilColor "49 00 00"
  //Renderstyle Translucent
  //Alpha 0.8
  +NOTELEPORT
  +CLIENTSIDEONLY
  +FORCEXYBILLBOARD
  +MOVEWITHSECTOR
  +FLOORCLIP
  +MISSILE
  -DONTSPLASH
  +NOBLOCKMAP
  //+NoInteraction
  Scale 1.0
  Decal K8GoreBloodSplatTransient_Blue

  States {
    Spawn:
      BPDL A 0
      BPDL A 0 A_JumpIfCVarFalse("r_models", "Die") // no models -- die immediately
      BPDL A 0 A_Jump(256, "Pool1", "Pool2")

    Pool1:
      BPDL A 0
      Goto MainProcessor

    Pool2:
      BPDL B 0
      Goto MainProcessor

    MainProcessor:
      "####" "#" 0 A_JumpIf(waterlevel > 1, "Splash")
      "####" "#" 0 A_LayToFloorWithYaw(Random(0, 360))
      //"####" "#" 0 A_SetRollExt(0)
      //"####" "#" 0 A_SetYawExt(Random(0, 360))
      //"####" "#" 0 A_SetPitchExt(0)
      "####" "#" 0 A_SetScaleXExt(Random(6, 12)/10.0)

    WaitFloor:
      "####" "#" 5 A_CheckFloor("ItLanded")
      Loop
    ItLanded:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      "####" "#" 0 A_k8JumpIfLiquidFloor("ItLandedOnWater")

    Live:
      "####" "#" random(400, 900)
      "####" "#" 0 A_Jump(16, "ItLandedOnWater") // fadeout
      Loop

    ItLandedOnWater:
      "####" "#" 5 A_FadeOut(0.1)
      Loop

    Splash:
      B8OD A 0
      Stop

    Death:
      "####" "#" 0
        {
          A_ChangeVelocity(0, 0, 0, CVF_REPLACE);
          A_ChangeFlag("NoInteraction", true);
        }
      Goto WaitFloor

    Die:
      TNT1 A 1
      Stop
  }
}


// ////////////////////////////////////////////////////////////////////////// //
